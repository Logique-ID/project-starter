<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 89e8d16c-3bdd-4cec-81f1-2159be2f17d1 (2026-01-09 03:51Z) -->

# Post_gen hook execution issue (2026-01-09 03:51Z)

_**User (2026-01-09 03:51Z)**_

@src/hooks/post_gen.dart:17-33 
i added this process in post_gen hooks, but it's like stuck when execute it, any idea?

---

_**Agent (model claude-4.5-opus-high-thinking, mode Ask)**_

<think><details><summary>Thought Process</summary>
The user is having an issue with the post_gen hooks where the process gets stuck when executing the flutterfire-config.sh script. Let me look at the code to understand what's happening.

Looking at the attached selection, they're running `Future.wait` with three parallel executions of `flutterfire-config.sh` with different flavors (dev, stg, prod).

I should:
1. Look at the `flutterfire-config.sh` script to see what it does
2. Look at `HookHelper.runCommand` to understand how commands are executed
3. Check if there's any issue with running these in parallel

Let me read these files to understand the problem.</details></think>

---

Let me look at the `flutterfire-config.sh` script and the `HookHelper.runCommand` implementation to understand what might be causing the hang.

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/flutterfire-config.sh</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper.dart</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I can see the issue. Let me analyze:

1. The `flutterfire-config.sh` script runs `flutterfire config` command with various arguments. 

2. Looking at the shell script, I notice a **syntax error** in the script - the line continuation is incorrect. In lines 19-21, 31-33, and 43-45, there's a problem:

```bash
      --android-out=android/app/src/dev/google-services.json
      --platforms=android,ios \
      --yes
```

The line ending with `google-services.json` doesn't have a backslash (`\`) for line continuation, but then tries to continue with `--platforms=...`. This means the script might be executing:
1. First, `flutterfire config` with only the arguments up to `--android-out`
2. Then trying to run `--platforms=android,ios \` as a separate command (which would fail or behave unexpectedly)

But wait, I looked again and actually the issue is:
- Line 19: `--android-out=android/app/src/dev/google-services.json` - NO backslash at end
- Line 20: `--platforms=android,ios \` - has backslash

So actually the command is being split. The first part runs `flutterfire config` with parameters up to `--android-out`, and then `--platforms=android,ios` would try to run as a separate command.

Actually, wait - let me re-read. The shell script shows:
```
--android-out=android/app/src/dev/google-services.json
      --platforms=android,ios \
      --yes
```

There's no backslash after `google-services.json`. This means bash will treat the command as complete after that line. The next line `--platforms=android,ios \` would be interpreted as a new command (which would fail).

But the main issue with it being "stuck" is likely something else. 

The `flutterfire config` command is interactive and prompts for input when needed. Since the line continuation bug prevents `--yes` from reaching the actual command, it's waiting for user confirmation. Running three `flutterfire` commands in parallel also creates contention—they compete for Firebase CLI locks and authentication, which can cause the process to hang.</details></think>

---

I can see two issues:

## Issue 1: Shell Script Syntax Error - Missing Line Continuation

The `flutterfire-config.sh` script has a **missing backslash** for line continuation. Look at lines 19-21 (and same pattern for stg/prod):

```18:22:/Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/flutterfire-config.sh
      --android-package-name={{app_id}}.dev \
      --android-out=android/app/src/dev/google-services.json
      --platforms=android,ios \
      --yes
```

The line ending with `google-services.json` is **missing a backslash** (`\`). This breaks the command - so `--platforms` and `--yes` are never passed to `flutterfire config`. 

Without `--yes`, the `flutterfire config` command **waits for interactive confirmation**, which causes the hang since `Process.run` captures stdin.

## Issue 2: Running flutterfire in Parallel

Running three `flutterfire config` commands simultaneously can cause issues:
- Firebase CLI may have lock contention
- Authentication state may conflict
- Race conditions on shared resources

## Fix

**1. Fix the shell script** - add missing backslashes:

```bash
  dev)
    flutterfire config \
      --project={{firebase_project_id}} \
      --out=lib/firebase_options/firebase_options_dev.dart \
      --ios-bundle-id={{app_id}}.dev \
      --ios-out=ios/flavors/dev/GoogleService-Info.plist \
      --ios-build-config=Debug-dev \
      --android-package-name={{app_id}}.dev \
      --android-out=android/app/src/dev/google-services.json \
      --platforms=android,ios \
      --yes
    ;;
```

Apply the same fix to `stg` and `prod` cases (add `\` after the `--android-out` line).

**2. Run sequentially instead of in parallel** in `post_gen.dart`:

```dart
// Run sequentially to avoid Firebase CLI conflicts
await HookHelper.runCommand(
  context,
  command: 'sh',
  arguments: ['flutterfire-config.sh', 'dev'],
);
await HookHelper.runCommand(
  context,
  command: 'sh',
  arguments: ['flutterfire-config.sh', 'stg'],
);
await HookHelper.runCommand(
  context,
  command: 'sh',
  arguments: ['flutterfire-config.sh', 'prod'],
);
```

The primary cause of the hang is the missing `--yes` flag due to the shell syntax error. Once that's fixed, you may be able to keep parallel execution, but sequential is safer for Firebase CLI operations.

---

