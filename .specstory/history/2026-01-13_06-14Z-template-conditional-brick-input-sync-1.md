<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session fa87f01c-a6da-4221-8854-97946adf68fa (2026-01-13 06:14Z) -->

# Template conditional brick input sync (2026-01-13 06:14Z)

_**User (2026-01-13 01:10Z)**_

@src/__brick__ take a look on brick template

---

_**Agent (model default, mode Ask)**_



---


Reviewing the brick template structure and key files.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/brick.yaml</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/README.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/pubspec.yaml</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---



---


Exploring key files to understand the template structure:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/main_dev.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/src/app.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/src/routing/app_router.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/flavor.dart</summary>

</details>
</tool-use>

---



---


Checking a few more files to understand the architecture:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/initializer.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/src/utils/data_source_config/{{#use_dio}}dio{{/use_dio}}/dio_config.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/__brick__/{{project_name}}/lib/src/feature/login/presentation/login_screen.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/post_gen.dart</summary>

</details>
</tool-use>

---



---


## Overview

A Mason brick template for generating Flutter projects with:
- Multi-flavor support (dev, stg, prod)
- Optional Firebase integration
- Optional localization
- Optional Dio HTTP client with Alice debugging
- Riverpod state management
- GoRouter navigation
- Clean architecture structure

## Key Components

### 1. **Brick Configuration** (`brick.yaml`)
Defines 6 variables:
- `project_name` - snake_case project name
- `app_name` - Display name
- `app_id` - Bundle ID (e.g., com.example.myapp)
- `custom_icon` - Use custom app icon
- `use_splash` - Implement splash screen
- `use_firebase` - Firebase integration
- `use_localization` - Localization support
- `use_dio` - Dio HTTP client with Alice

### 2. **Project Structure**

**Entry Points:**
- `main_dev.dart`, `main_stg.dart`, `main_prod.dart` - Flavor-specific entry points
- `initializer.dart` - App initialization (Firebase, splash, etc.)
- `flavor.dart` - Flavor configuration with API URLs, image URLs, API keys

**Architecture:**
```
lib/src/
‚îú‚îÄ‚îÄ feature/          # Feature modules (login, home, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ authentication/
‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îú‚îÄ‚îÄ home/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ common_widget/    # Reusable widgets
‚îú‚îÄ‚îÄ routing/          # GoRouter configuration
‚îú‚îÄ‚îÄ theme/            # App theming
‚îú‚îÄ‚îÄ localization/     # i18n (conditional)
‚îî‚îÄ‚îÄ utils/            # Utilities including Dio config (conditional)
```

### 3. **Conditional Features**

Uses Mustache templating (`{{#use_firebase}}...{{/use_firebase}}`) for:
- Firebase: imports, initialization, service setup
- Localization: ARB files, localization delegates
- Dio: HTTP client configuration with interceptors, Alice debugging

### 4. **Hooks**

**Pre-generation** (`pre_gen.dart`):
- Prompts for Firebase project ID if enabled
- Prompts for custom icon path if enabled
- Prompts for splash image path if enabled

**Post-generation** (`post_gen.dart`):
- Creates Android Kotlin package structure from `app_id`
- Runs `flutterfire-config.sh` for all flavors (if Firebase enabled)
- Copies and generates app icons (if custom icon provided)
- Generates native splash (if splash enabled)

### 5. **Features Included**

- Authentication: Auth repository with session management
- Login: Complete login flow with form validation
- Navigation: Bottom nav with multiple subscreens (home, berita, kegiatan, laporan, faq)
- HTTP Client: Dio with interceptors for auth, error handling, token refresh (commented)
- State Management: Riverpod with code generation
- Theming: Custom theme system
- Forms: FormBuilder integration
- Database: Sembast with encryption

### 6. **Platform Configuration**

- Android: Flavorizr configuration, Gradle setup, package structure
- iOS: Xcode project with flavor schemes, Podfile
- Assets: Icon and splash screen assets organized by platform

## Observations

1. Hardcoded strings: Some UI strings use `.hardcoded` extension (e.g., `'Silakan login'.hardcoded`) instead of localization
2. TODOs: Several TODOs in router redirect logic and login screen
3. Token refresh: Refresh token logic is commented out in Dio config
4. Package structure: Android Kotlin package is created from `app_id` in post-gen hook

The template is production-ready and follows Flutter best practices with a modular, scalable architecture.

---

_**User (2026-01-13 01:10Z)**_

I wonder how to update the template (like add new feature template etc) inside it?

Because the template can't we run using flutter, so i separate the real template project of the brick

Any suggest or strategy to overcome this?

---

_**Agent (model default, mode Ask)**_



---


Reviewing the current structure to propose a strategy for managing and updating the brick template.


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/Logique/Project Starter/project-starter/README.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** ‚Ä¢ Searched codebase "How is the brick template tested or validated? Are there any scripts for generating test projects?" ‚Ä¢ **15** results</summary>
            
| File | Lines |
|------|-------|
| `README.md` | L120-175 |
| `src/__brick__/{{project_name}}/README.md` | L67 |
| `README.md` | L170-227 |
| `README.md` | L71 |
| `src/README.md` | L58 |
| `src/brick.yaml` | L49 |
| `src/README.md` | L55-101 |
| `src/__brick__/{{project_name}}/test/widget_test.dart` | L29 |
| `src/CHANGELOG.md` | L114-139 |
| `src/__brick__/{{project_name}}/{{#use_firebase}}flutterfire-config.sh{{/use_firebase}}` | L51 |
| `src/__brick__/{{project_name}}/pubspec.yaml` | L88 |
| `mason.yaml` | L3 |
| `src/__brick__/{{project_name}}/.cursor/rules/project-structure.mdc` | L56 |
| `README.md` | L69-122 |
| `src/hooks/post_gen.dart` | L42 |

</details>
</tool-use>

---



---


Here‚Äôs a workflow for developing and updating the brick template:

## Recommended Strategy: Dual-Repository Approach

### 1. **Project Structure**

```
project-starter/                    # Brick repository
‚îú‚îÄ‚îÄ src/__brick__/                 # Template source (Mustache variables)
‚îÇ   ‚îî‚îÄ‚îÄ {{project_name}}/
‚îú‚îÄ‚îÄ reference/                     # Working Flutter project (NEW)
‚îÇ   ‚îî‚îÄ‚îÄ reference_app/            # Actual runnable Flutter app
‚îÇ       ‚îú‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ pubspec.yaml
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts/                       # Automation scripts (NEW)
‚îÇ   ‚îú‚îÄ‚îÄ sync-to-template.dart     # Convert reference ‚Üí template
‚îÇ   ‚îú‚îÄ‚îÄ sync-from-template.dart   # Convert template ‚Üí reference
‚îÇ   ‚îî‚îÄ‚îÄ test-template.dart        # Generate & test template
‚îî‚îÄ‚îÄ test_output/                   # Generated test projects (gitignored)
```

### 2. **Development Workflow**

**Option A: Reference-First (Recommended)**

1. Develop in `reference/reference_app/` (real Flutter project)
2. Test and verify it works
3. Sync changes back to template using a script
4. Test template generation

**Option B: Template-First**

1. Edit template directly in `src/__brick__/`
2. Generate test project: `mason make starter --output-dir ./test_output`
3. Test in generated project
4. If changes needed, apply to template and regenerate

### 3. **Sync Scripts**

Create automation scripts to convert between reference and template:

**`scripts/sync-to-template.dart`** - Converts reference app ‚Üí template:

```dart
import 'dart:io';
import 'package:path/path.dart' as path;

void main() async {
  final referenceDir = Directory('reference/reference_app');
  final templateDir = Directory('src/__brick__/{{project_name}}');
  
  // Sync lib/ directory
  await syncDirectory(
    source: Directory(path.join(referenceDir.path, 'lib')),
    target: Directory(path.join(templateDir.path, 'lib')),
    replacements: {
      'reference_app': '{{project_name}}',
      'ReferenceApp': '{{app_name}}',
      'com.example.reference': '{{app_id}}',
    },
  );
  
  // Sync pubspec.yaml with variable substitution
  await syncPubspec(
    source: File(path.join(referenceDir.path, 'pubspec.yaml')),
    target: File(path.join(templateDir.path, 'pubspec.yaml')),
  );
  
  print('‚úÖ Synced reference app to template');
}

Future<void> syncDirectory({
  required Directory source,
  required Directory target,
  required Map<String, String> replacements,
}) async {
  await for (final entity in source.list(recursive: true)) {
    if (entity is File) {
      final relativePath = path.relative(entity.path, from: source.path);
      final targetPath = path.join(target.path, relativePath);
      
      // Apply replacements to path
      var processedPath = targetPath;
      replacements.forEach((key, value) {
        processedPath = processedPath.replaceAll(key, value);
      });
      
      await File(processedPath).create(recursive: true);
      var content = await entity.readAsString();
      
      // Apply replacements to content
      replacements.forEach((key, value) {
        content = content.replaceAll(key, value);
      });
      
      await File(processedPath).writeAsString(content);
    }
  }
}
```

**`scripts/sync-from-template.dart`** - Generates reference from template:

```dart
import 'dart:io';
import 'package:mason/mason.dart';

void main() async {
  // Generate template with test values
  await Process.run('mason', [
    'make',
    'starter',
    '--project_name', 'reference_app',
    '--app_name', 'Reference App',
    '--app_id', 'com.example.reference',
    '--custom_icon', 'false',
    '--use_splash', 'true',
    '--use_firebase', 'false',
    '--use_localization', 'true',
    '--use_dio', 'true',
    '--output-dir', 'reference',
  ]);
  
  print('‚úÖ Generated reference app from template');
}
```

### 4. **Enhanced Testing Script**

**`scripts/test-template.dart`** - Automated testing:

```dart
import 'dart:io';
import 'package:process/process.dart';

void main() async {
  final process = LocalProcess();
  final testDir = Directory('test_output/test_app');
  
  // Clean previous test
  if (await testDir.exists()) {
    await testDir.delete(recursive: true);
  }
  
  print('üß™ Generating test project...');
  await process.run('mason', [
    'make',
    'starter',
    '--project_name', 'test_app',
    '--app_name', 'Test App',
    '--app_id', 'com.test.app',
    '--output-dir', 'test_output',
  ]);
  
  print('üì¶ Getting dependencies...');
  await process.run('flutter', ['pub', 'get'], workingDirectory: testDir.path);
  
  print('üî® Running build_runner...');
  await process.run('flutter', [
    'pub', 'run', 'build_runner', 'build', '--delete-conflicting-outputs'
  ], workingDirectory: testDir.path);
  
  print('‚úÖ Template test complete!');
  print('üìÅ Test project at: ${testDir.absolute.path}');
}
```

### 5. **Makefile for Common Tasks**

**`Makefile`**:

```makefile
.PHONY: test sync-to-template sync-from-template dev

# Test the template by generating a project
test:
	@dart run scripts/test-template.dart

# Sync reference app changes to template
sync-to-template:
	@dart run scripts/sync-to-template.dart

# Generate reference app from template
sync-from-template:
	@dart run scripts/sync-from-template.dart

# Development workflow: sync reference ‚Üí test template
dev: sync-to-template test

# Clean test outputs
clean:
	@rm -rf test_output/
	@rm -rf reference/reference_app/
```

### 6. **Feature Addition Workflow**

When adding a new feature (e.g., a new screen):

1. Add to reference app:
   ```bash
   cd reference/reference_app
   # Create new feature: lib/src/feature/profile/
   # Test it works
   flutter run --flavor dev
   ```

2. Sync to template:
   ```bash
   make sync-to-template
   ```

3. Test template generation:
   ```bash
   make test
   ```

4. Verify generated project:
   ```bash
   cd test_output/test_app
   flutter run --flavor dev
   ```

### 7. **Template Variable Management**

Create a mapping file for consistent variable replacement:

**`scripts/template_vars.json`**:

```json
{
  "reference": {
    "project_name": "reference_app",
    "app_name": "Reference App",
    "app_id": "com.example.reference"
  },
  "template": {
    "project_name": "{{project_name}}",
    "app_name": "{{app_name}}",
    "app_id": "{{app_id}}"
  }
}
```

### 8. **Git Strategy**

**`.gitignore`** additions:

```
# Test outputs
test_output/
reference/reference_app/
*.g.dart
*.freezed.dart
```

**Branch strategy:**
- `main` - Stable template
- `dev` - Active development
- `reference/` - Keep reference app in separate branch or submodule

### 9. **Documentation Updates**

Add to your README:

```markdown
## Development Workflow

### Adding New Features

1. **Develop in Reference App** (recommended):
   ```bash
   cd reference/reference_app
   # Make your changes
   flutter run --flavor dev
   ```

2. **Sync to Template**:
   ```bash
   make sync-to-template
   ```

3. **Test Template**:
   ```bash
   make test
   ```

### Direct Template Editing

If editing template directly:
```bash
# Edit files in src/__brick__/{{project_name}}/
# Test generation
make test
# Verify in test_output/test_app
```
```

### 10. **Advanced: Watch Mode**

For active development, use a file watcher:

**`scripts/watch-and-sync.dart`**:

```dart
import 'dart:async';
import 'dart:io';
import 'package:watcher/watcher.dart';

void main() async {
  final referenceDir = Directory('reference/reference_app/lib');
  print('üëÄ Watching ${referenceDir.path} for changes...');
  
  final watcher = DirectoryWatcher(referenceDir.path);
  watcher.events.listen((event) {
    if (event.type == ChangeType.MODIFY || event.type == ChangeType.ADD) {
      print('üîÑ Change detected: ${event.path}');
      // Auto-sync after debounce
      Timer(Duration(seconds: 2), () {
        Process.run('dart', ['run', 'scripts/sync-to-template.dart']);
      });
    }
  });
}
```

## Summary

- Use a reference Flutter app for development and testing
- Automate syncing between reference and template
- Test template generation after each change
- Keep reference and template in sync
- Use scripts/Makefile for common tasks

This lets you develop features in a runnable project, then sync them to the template. Should I create these scripts or help set up the reference project structure?

---

_**User (2026-01-13 01:10Z)**_

what about the template that already implement conditional brick input when sync happen between template & reference project?

---

_**Agent (model default, mode Ask)**_



---

Handling conditional blocks (`{{#use_firebase}}`, `{{#use_dio}}`, etc.) during sync is critical. Here's a strategy that preserves conditionals:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/{{project_name}}/lib/main_dev.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: /Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/{{project_name}}/lib/src/app.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "\{\{#.*\}\}" in "/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__" ‚Ä¢ 51 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/pubspec.yaml` | `\{{#use_localization\}}` | L13 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/pubspec.yaml` | `\{{#use_splash\}}` | L32 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/pubspec.yaml` | `\{{#use_firebase\}}` | L37 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/pubspec.yaml` | `\{{#use_dio\}}` | L51 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/pubspec.yaml` | `\{{#use_localization\}}` | L76 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/pubspec.yaml` | `\{{#use_splash\}}` | L100 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/service/notification/local_notification.dart` | `\{{#use_firebase\}}` | L3 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/service/notification/local_notification.dart` | `\{{#use_firebase\}}` | L9 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/service/notification/local_notification.dart` | `\{{#use_firebase\}}` | L97 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/service/notification/local_notification.dart` | `\{{#use_firebase\}}` | L103 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/service/notification/local_notification.dart` | `\{{#use_firebase\}}` | L128 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_startup.dart` | `\{{#use_splash\}}` | L3 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_startup.dart` | `\{{#use_localization\}}` | L12 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_startup.dart` | `\{{#use_firebase\}}` | L15 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_startup.dart` | `\{{#use_localization\}}` | L30 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_startup.dart` | `\{{#use_firebase\}}` | L33 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_startup.dart` | `\{{#use_splash\}}` | L36 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_router.dart` | `\{{#use_dio\}}` | L12 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/routing/app_router.dart` | `\{{#use_dio\}}` | L24 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/presentation/login_screen.dart` | `\{{#use_localization\}}` | L11 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/presentation/login_screen.dart` | `with LoginState, LoginEvent\{{#use_localization\}}, LocalizationMixin\{{/use_localization\}} \{` | L23 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/presentation/login_screen.dart` | `\{{#use_localization\}}` | L46 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/presentation/login_screen.dart` | `appBar: AppBar(title: Text(\{{#use_localization\}}loc.login\{{/use_localization\}}\{{^use_localization\}}'Login'.hardcoded\{{/use_localization\}}), centerTitle: true),` | L51 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/presentation/login_screen.dart` | `text: \{{#use_localization\}}loc.login\{{/use_localization\}}\{{^use_localization\}}'Login'.hardcoded\{{/use_localization\}},` | L91 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/data/login_repository.dart` | `\{{#use_dio\}}` | L1 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/data/login_repository.dart` | `\{{#use_dio\}}` | L6 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/login/data/login_repository.dart` | `\{{#use_dio\}}` | L22 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/home/presentation/home_subscreen.dart` | `\{{#use_localization\}}` | L5 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/home/presentation/home_subscreen.dart` | `class HomeSubscreen extends ConsumerWidget with HomeEvent\{{#use_localization\}}, LocalizationMixin\{{/use_localization\}} \{` | L13 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/home/presentation/home_subscreen.dart` | `\{{#use_localization\}}` | L18 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/feature/home/presentation/home_subscreen.dart` | `text: \{{#use_localization\}}loc.login\{{/use_localization\}}\{{^use_localization\}}'Login'.hardcoded\{{/use_localization\}},` | L29 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/app.dart` | `\{{#use_localization\}}` | L8 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/src/app.dart` | `\{{#use_localization\}}` | L28 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/main_stg.dart` | `\{{#use_firebase\}}` | L1 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/main_stg.dart` | `await initializeApp(\{{#use_firebase\}}firebaseOptions: DefaultFirebaseOptions.currentPlatform\{{/use_firebase\}});` | L9 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/main_prod.dart` | `\{{#use_firebase\}}` | L1 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/main_prod.dart` | `await initializeApp(\{{#use_firebase\}}firebaseOptions: DefaultFirebaseOptions.currentPlatform\{{/use_firebase\}});` | L9 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/main_dev.dart` | `\{{#use_firebase\}}` | L1 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/main_dev.dart` | `await initializeApp(\{{#use_firebase\}}firebaseOptions: DefaultFirebaseOptions.currentPlatform\{{/use_firebase\}});` | L9 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/initializer.dart` | `\{{#use_firebase\}}` | L1 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/initializer.dart` | `\{{#use_splash\}}` | L6 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/initializer.dart` | `\{{#use_firebase\}}` | L12 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/initializer.dart` | `Future<void> initializeApp(\{{#use_firebase\}}\{required FirebaseOptions firebaseOptions\}{\{/use_firebase\}}) async \{` | L16 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/initializer.dart` | `\{{#use_splash\}}` | L17 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/lib/initializer.dart` | `\{{#use_firebase\}}` | L25 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/ios/Runner.xcodeproj/project.pbxproj` | `\{{#use_firebase\}}` | L264 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/ios/Runner.xcodeproj/project.pbxproj` | `\{{#use_firebase\}}` | L440 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/android/settings.gradle.kts` | `\{{#use_firebase\}}` | L22 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/android/app/build.gradle.kts` | `\{{#use_firebase\}}` | L3 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/README.md` | `\{{#use_firebase\}}` | L26 |
| `/Users/cirimin/.cursor/worktrees/project-starter/ebs/src/__brick__/\{{project_name\}}/README.md` | `\{{#use_firebase\}}4\{{^use_firebase\}}3\{{/use_firebase\}}. **Important**: Rename the Android Kotlin directory to match your app ID:` | L37 |


</details>
</tool-use>

---



---

Here‚Äôs a strategy to handle conditional blocks during sync:

## Strategy: Comment-Based Conditional Markers

Use special comments to mark conditional sections so they survive sync in both directions.

### 1. **Reference Project Configuration**

Create a config file that defines which features are enabled in the reference project:

**`reference/reference_config.json`**:

```json
{
  "features": {
    "use_firebase": true,
    "use_localization": true,
    "use_dio": true,
    "use_splash": true
  },
  "variables": {
    "project_name": "reference_app",
    "app_name": "Reference App",
    "app_id": "com.example.reference"
  }
}
```

### 2. **Enhanced Sync Script with Conditional Handling**

**`scripts/sync-to-template.dart`**:

```dart
import 'dart:io';
import 'dart:convert';
import 'package:path/path.dart' as path;

void main() async {
  final config = jsonDecode(
    await File('reference/reference_config.json').readAsString()
  ) as Map<String, dynamic>;
  
  final features = config['features'] as Map<String, dynamic>;
  final vars = config['variables'] as Map<String, dynamic>;
  
  await syncToTemplate(
    referenceDir: Directory('reference/reference_app'),
    templateDir: Directory('src/__brick__/{{project_name}}'),
    features: features,
    variables: vars,
  );
  
  print('‚úÖ Synced reference app to template');
}

Future<void> syncToTemplate({
  required Directory referenceDir,
  required Directory templateDir,
  required Map<String, dynamic> features,
  required Map<String, dynamic> variables,
}) async {
  await for (final entity in referenceDir.list(recursive: true)) {
    if (entity is File && shouldSyncFile(entity)) {
      final relativePath = path.relative(entity.path, from: referenceDir.path);
      final targetPath = _convertToTemplatePath(relativePath, variables);
      final targetFile = File(path.join(templateDir.path, targetPath));
      
      await targetFile.create(recursive: true);
      
      var content = await entity.readAsString();
      
      // Step 1: Replace variables
      content = _replaceVariables(content, variables);
      
      // Step 2: Restore conditional blocks from markers
      content = _restoreConditionals(content, features);
      
      await targetFile.writeAsString(content);
    }
  }
}

String _restoreConditionals(String content, Map<String, dynamic> features) {
  // Pattern: // BRICK_COND_START:use_firebase ... // BRICK_COND_END:use_firebase
  final condPattern = RegExp(
    r'//\s*BRICK_COND_START:(\w+)\s*\n(.*?)//\s*BRICK_COND_END:\1',
    dotAll: true,
  );
  
  return content.replaceAllMapped(condPattern, (match) {
    final featureName = match.group(1)!;
    final blockContent = match.group(2)!;
    final isEnabled = features[featureName] == true;
    
    if (isEnabled) {
      return '{{#$featureName}}\n$blockContent{{/$featureName}}';
    } else {
      return '{{^$featureName}}\n$blockContent{{/$featureName}}';
    }
  });
}

String _replaceVariables(String content, Map<String, dynamic> variables) {
  var result = content;
  variables.forEach((key, value) {
    result = result.replaceAll(value.toString(), '{{$key}}');
  });
  return result;
}

String _convertToTemplatePath(String relativePath, Map<String, dynamic> vars) {
  var path = relativePath;
  vars.forEach((key, value) {
    path = path.replaceAll(value.toString(), '{{$key}}');
  });
  return path;
}

bool shouldSyncFile(File file) {
  final ext = path.extension(file.path);
  return ['.dart', '.yaml', '.kt', '.swift', '.xml', '.json', '.md', '.sh']
      .contains(ext);
}
```

### 3. **Reference Project with Conditional Markers**

When you edit the reference project, use comment markers to indicate conditional sections:

**`reference/reference_app/lib/main_dev.dart`**:

```dart
// BRICK_COND_START:use_firebase
import 'firebase_options/firebase_options_dev.dart';
// BRICK_COND_END:use_firebase
import 'flavor.dart';
import 'initializer.dart';

void main() async {
  F.appFlavor = Flavor.dev;
  await initializeApp(
    // BRICK_COND_START:use_firebase
    firebaseOptions: DefaultFirebaseOptions.currentPlatform
    // BRICK_COND_END:use_firebase
  );
}
```

**`reference/reference_app/lib/src/app.dart`**:

```dart
import 'package:flutter/material.dart';
// ... other imports ...

import 'core/mixins/router_mixin.dart';
// BRICK_COND_START:use_localization
import 'localization/app_localization_repository.dart';
import 'localization/app_localizations.dart';
// BRICK_COND_END:use_localization
import 'theme/app_theme.dart';

class App extends ConsumerWidget with RouterMixin {
  // ... class code ...
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return ScreenUtilInit(
      // ... ScreenUtilInit config ...
      builder: (BuildContext context, Widget? child) {
        return MaterialApp.router(
          // ... router config ...
          // BRICK_COND_START:use_localization
          localizationsDelegates: const [
            ...AppLocalizations.localizationsDelegates,
          ],
          locale: Locale(ref.watch(localeProvider)),
          supportedLocales: AppLocalizations.supportedLocales,
          // BRICK_COND_END:use_localization
          builder: (context, widget) => _OrientationLocker(
            child: ConnectionListenerWidget(child: widget!),
          ),
          theme: appLightTheme,
        );
      },
    );
  }
}
```

### 4. **Template ‚Üí Reference Sync (Resolve Conditionals)**

**`scripts/sync-from-template.dart`**:

```dart
import 'dart:io';
import 'dart:convert';
import 'package:path/path.dart' as path;

void main() async {
  final config = jsonDecode(
    await File('reference/reference_config.json').readAsString()
  ) as Map<String, dynamic>;
  
  final features = config['features'] as Map<String, dynamic>;
  final vars = config['variables'] as Map<String, dynamic>;
  
  // Generate from template
  await Process.run('mason', [
    'make',
    'starter',
    '--project_name', vars['project_name'] as String,
    '--app_name', vars['app_name'] as String,
    '--app_id', vars['app_id'] as String,
    '--custom_icon', 'false',
    '--use_splash', features['use_splash'].toString(),
    '--use_firebase', features['use_firebase'].toString(),
    '--use_localization', features['use_localization'].toString(),
    '--use_dio', features['use_dio'].toString(),
    '--output-dir', 'reference',
  ]);
  
  // Post-process: Add conditional markers
  await addConditionalMarkers(
    Directory('reference/${vars['project_name']}'),
    features,
  );
  
  print('‚úÖ Generated reference app with conditional markers');
}

Future<void> addConditionalMarkers(
  Directory projectDir,
  Map<String, dynamic> features,
) async {
  await for (final entity in projectDir.list(recursive: true)) {
    if (entity is File && path.extension(entity.path) == '.dart') {
      var content = await entity.readAsString();
      content = _addConditionalMarkers(content, features);
      await entity.writeAsString(content);
    }
  }
}

String _addConditionalMarkers(String content, Map<String, dynamic> features) {
  // Pattern: {{#use_firebase}}...{{/use_firebase}}
  final condPattern = RegExp(
    r'\{\{#(\w+)\}\}(.*?)\{\{/\1\}\}',
    dotAll: true,
  );
  
  return content.replaceAllMapped(condPattern, (match) {
    final featureName = match.group(1)!;
    final blockContent = match.group(2)!;
    
    // Only add markers if this feature is enabled in reference
    if (features[featureName] == true) {
      return '// BRICK_COND_START:$featureName\n'
          '${blockContent.trim()}\n'
          '// BRICK_COND_END:$featureName';
    } else {
      // For disabled features, remove the block entirely
      return '';
    }
  });
}
```

### 5. **Handling Inverted Conditionals**

For `{{^use_localization}}` blocks:

```dart
String _restoreConditionals(String content, Map<String, dynamic> features) {
  // Handle positive conditionals: {{#feature}}
  var result = content.replaceAllMapped(
    RegExp(r'//\s*BRICK_COND_START:(\w+)\s*\n(.*?)//\s*BRICK_COND_END:\1', dotAll: true),
    (match) {
      final featureName = match.group(1)!;
      final blockContent = match.group(2)!;
      final isEnabled = features[featureName] == true;
      
      return isEnabled
          ? '{{#$featureName}}\n$blockContent{{/$featureName}}'
          : '';
    },
  );
  
  // Handle inverted conditionals: {{^feature}}
  result = result.replaceAllMapped(
    RegExp(r'//\s*BRICK_COND_INVERT_START:(\w+)\s*\n(.*?)//\s*BRICK_COND_INVERT_END:\1', dotAll: true),
    (match) {
      final featureName = match.group(1)!;
      final blockContent = match.group(2)!;
      final isEnabled = features[featureName] == true;
      
      return !isEnabled
          ? '{{^$featureName}}\n$blockContent{{/$featureName}}'
          : '';
    },
  );
  
  return result;
}
```

### 6. **Inline Conditionals**

For inline conditionals like `{{#use_localization}}loc.login{{/use_localization}}{{^use_localization}}'Login'.hardcoded{{/use_localization}}`:

**In reference project:**
```dart
appBar: AppBar(
  title: Text(
    // BRICK_COND_INLINE_START:use_localization
    loc.login
    // BRICK_COND_INLINE_END:use_localization
    // BRICK_COND_INLINE_INVERT_START:use_localization
    'Login'.hardcoded
    // BRICK_COND_INLINE_INVERT_END:use_localization
  ),
  centerTitle: true
),
```

**Sync script handles this:**
```dart
String _restoreInlineConditionals(String content, Map<String, dynamic> features) {
  // Pattern: // BRICK_COND_INLINE_START:feature ... // BRICK_COND_INLINE_END:feature
  final inlinePattern = RegExp(
    r'//\s*BRICK_COND_INLINE_START:(\w+)\s*\n(.*?)//\s*BRICK_COND_INLINE_END:\1',
    dotAll: true,
  );
  
  final invertPattern = RegExp(
    r'//\s*BRICK_COND_INLINE_INVERT_START:(\w+)\s*\n(.*?)//\s*BRICK_COND_INLINE_INVERT_END:\1',
    dotAll: true,
  );
  
  var result = content;
  
  // Replace inline positive conditionals
  result = result.replaceAllMapped(inlinePattern, (match) {
    final featureName = match.group(1)!;
    final blockContent = match.group(2)!.trim();
    final isEnabled = features[featureName] == true;
    
    if (isEnabled) {
      return '{{#$featureName}}$blockContent{{/$featureName}}';
    }
    return '';
  });
  
  // Replace inline inverted conditionals
  result = result.replaceAllMapped(invertPattern, (match) {
    final featureName = match.group(1)!;
    final blockContent = match.group(2)!.trim();
    final isEnabled = features[featureName] == true;
    
    if (!isEnabled) {
      return '{{^$featureName}}$blockContent{{/$featureName}}';
    }
    return '';
  });
  
  return result;
}
```

### 7. **File-Level Conditionals**

For files that only exist when a feature is enabled (like `{{#use_firebase}}flutterfire-config.sh{{/use_firebase}}`):

**`reference/reference_app/.brick_files.json`**:

```json
{
  "conditional_files": {
    "flutterfire-config.sh": "use_firebase",
    "l10n.yaml": "use_localization",
    "untranslated_msg_list.txt": "use_localization"
  },
  "conditional_directories": {
    "lib/firebase_options/": "use_firebase",
    "lib/src/utils/data_source_config/dio/": "use_dio"
  }
}
```

**Sync script:**
```dart
Future<void> syncConditionalFiles(
  Directory referenceDir,
  Directory templateDir,
  Map<String, String> conditionalFiles,
  Map<String, dynamic> features,
) async {
  conditionalFiles.forEach((filePath, featureName) {
    final shouldInclude = features[featureName] == true;
    final sourceFile = File(path.join(referenceDir.path, filePath));
    final targetPath = _convertToTemplatePath(filePath, variables);
    
    if (shouldInclude && await sourceFile.exists()) {
      // Sync file with conditional wrapper in template
      final templateFile = File(path.join(templateDir.path, '{{#$featureName}}$targetPath{{/$featureName}}'));
      // Actually, we need to handle this at directory level
    }
  });
}
```

### 8. **Complete Workflow**

**Makefile**:

```makefile
.PHONY: sync-to-template sync-from-template dev

# Sync reference ‚Üí template (preserves conditionals)
sync-to-template:
	@dart run scripts/sync-to-template.dart

# Generate reference from template (resolves conditionals)
sync-from-template:
	@dart run scripts/sync-from-template.dart

# Development: edit reference, then sync to template
dev: sync-to-template

# Update reference config
update-config:
	@code reference/reference_config.json
```

### 9. **Best Practices**

1. Always edit the reference project with conditional markers
2. Keep `reference_config.json` in sync with your development needs
3. Test both directions: template ‚Üí reference and reference ‚Üí template
4. Use markers consistently: `BRICK_COND_START:feature_name`
5. For new features, add to `reference_config.json` first

### 10. **Example: Adding a New Feature**

1. Update config:
   ```json
   {
     "features": {
       "use_analytics": true  // NEW
     }
   }
   ```

2. Add to reference project with markers:
   ```dart
   // BRICK_COND_START:use_analytics
   import 'package:firebase_analytics/firebase_analytics.dart';
   // BRICK_COND_END:use_analytics
   ```

3. Sync to template:
   ```bash
   make sync-to-template
   ```

4. Template now has:
   ```dart
   {{#use_analytics}}
   import 'package:firebase_analytics/firebase_analytics.dart';
   {{/use_analytics}}
   ```

This approach preserves conditionals during sync in both directions. Should I create these scripts or help set up the reference project structure?

---



---

