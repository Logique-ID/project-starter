<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session f69c13f3-be58-4326-b615-fd89e907dca8 (2026-01-22 02:00Z) -->

# Firebase project ID validation (2026-01-22 02:00Z)

_**User**_

 @src/hooks/pre_gen.dart add validation if firebase_project_id is empty on end step

---

_**Agent (model default, mode Agent)**_


Reviewing `pre_gen.dart` to add end-of-step validation that `firebase_project_id` is not empty.


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---


Adding end-of-step validation to ensure `firebase_project_id` is not empty when Firebase is enabled:


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>

</tool-use>

---





---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/hooks/pre_gen.dart"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/hooks/pre_gen.dart"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


Added validation at the end of `pre_gen.dart` to ensure `firebase_project_id` is not empty when `use_firebase` is true.

The validation:
- Runs after all prompts
- Checks if `firebase_project_id` is null or empty (including whitespace-only)
- Throws a `MasonException` with a clear error message if validation fails

This ensures that when Firebase is enabled, a valid project ID is provided before the generation continues.

---

_**User**_

what happen if firebase_project_id is empty?

---

_**Agent (model default, mode Agent)**_


Checking the current implementation to explain what happens when `firebase_project_id` is empty:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---


If `firebase_project_id` is empty when `use_firebase` is true, the validation at lines 78-86 will:

1. Throw a `MasonException` with the message: `"firebase_project_id is required when use_firebase is true"`
2. Stop the generation process — the `pre_gen.dart` hook fails, so project generation stops
3. Display the error to the user — Mason shows the exception message

**Flow:**
- User sets `use_firebase: true`
- If `firebase_project_id` is not provided (via config.json or arguments), the code prompts for it (lines 10-15)
- If the user enters an empty string or just whitespace, the validation at the end (lines 78-86) catches it
- The exception is thrown before `progress.complete()` is called, so generation stops

**Why this matters:**
- Prevents generating a project with Firebase enabled but no project ID
- Fails fast before template generation
- Provides a clear error message

The validation uses `.trim()` to catch whitespace-only input, so a value like `"   "` is treated as empty.

---

_**User**_

Any method to show error message more interactive?

---

_**Agent (model default, mode Agent)**_


Checking available logger methods in Mason to make the error handling more interactive:


---

<tool-use data-tool-type="unknown" data-tool-name="semantic_search_full">
<details>
<summary>Tool use: **semantic_search_full**</summary>


Parameters:

```json
{
  "query": "What logger methods are available in Mason HookContext for displaying errors or messages?",
  "topK": 10,
  "explanation": ""
}
```
Result:

```json
{
  "codeResults": [
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/hooks/helper.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 39
          }
        },
        "contents": "import 'dart:io';\n\nimport 'package:mason/mason.dart';\nimport 'package:path/path.dart' as path;\n\nclass HookHelper {\n  static Future&lt;void&gt; runCommand(\n    HookContext context, {\n    required String command,\n    required List&lt;String&gt; arguments,\n  }) async {\n    final projectName = context.vars['project_name'] as String;\n    final directory = \"${Directory.current.path}/$projectName\";\n\n    /// Run a command in the generated directory\n    final process = context.logger.progress('Running $command $arguments');\n    final result = await Process.run(\n      command,\n      arguments,\n      workingDirectory: directory,\n    );\n\n    if (result.exitCode == 0) {\n      process.complete('Successfully executed $command ${arguments.join(' ')}');\n    } else {\n      process.fail('Failed to execute $command ${arguments.join(' ')}');\n      context.logger.err('Error: ${result.stderr}');\n    }\n  }\n\n  /// Overwrites a file in the generated project directory.\n  /// Automatically searches for [originalFileName] in the directory tree.\n  static Future&lt;void&gt; overwriteFile(\n    HookContext context, {\n    required String sourcePath,\n    required String originalFileName,\n  }) async {\n    final sourceFile = File(sourcePath);",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:io';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "import 'package:mason/mason.dart';",
            "lineNumber": 3
          },
          {
            "text": "import 'package:path/path.dart' as path;",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class HookHelper {",
            "lineNumber": 6
          },
          {
            "text": "  static Future&lt;void&gt; runCommand(",
            "lineNumber": 7
          },
          {
            "text": "    HookContext context, {",
            "lineNumber": 8
          },
          {
            "text": "    required String command,",
            "lineNumber": 9
          },
          {
            "text": "    required List&lt;String&gt; arguments,",
            "lineNumber": 10
          },
          {
            "text": "  }) async {",
            "lineNumber": 11
          },
          {
            "text": "    final projectName = context.vars['project_name'] as String;",
            "lineNumber": 12
          },
          {
            "text": "    final directory = \"${Directory.current.path}/$projectName\";",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "    /// Run a command in the generated directory",
            "lineNumber": 15
          },
          {
            "text": "    final process = context.logger.progress('Running $command $arguments');",
            "lineNumber": 16
          },
          {
            "text": "    final result = await Process.run(",
            "lineNumber": 17
          },
          {
            "text": "      command,",
            "lineNumber": 18
          },
          {
            "text": "      arguments,",
            "lineNumber": 19
          },
          {
            "text": "      workingDirectory: directory,",
            "lineNumber": 20
          },
          {
            "text": "    );",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "    if (result.exitCode == 0) {",
            "lineNumber": 23
          },
          {
            "text": "      process.complete('Successfully executed $command ${arguments.join(' ')}');",
            "lineNumber": 24
          },
          {
            "text": "    } else {",
            "lineNumber": 25
          },
          {
            "text": "      process.fail('Failed to execute $command ${arguments.join(' ')}');",
            "lineNumber": 26
          },
          {
            "text": "      context.logger.err('Error: ${result.stderr}');",
            "lineNumber": 27
          },
          {
            "text": "    }",
            "lineNumber": 28
          },
          {
            "text": "  }",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "  /// Overwrites a file in the generated project directory.",
            "lineNumber": 31
          },
          {
            "text": "  /// Automatically searches for [originalFileName] in the directory tree.",
            "lineNumber": 32
          },
          {
            "text": "  static Future&lt;void&gt; overwriteFile(",
            "lineNumber": 33
          },
          {
            "text": "    HookContext context, {",
            "lineNumber": 34
          },
          {
            "text": "    required String sourcePath,",
            "lineNumber": 35
          },
          {
            "text": "    required String originalFileName,",
            "lineNumber": 36
          },
          {
            "text": "  }) async {",
            "lineNumber": 37
          },
          {
            "text": "    final sourceFile = File(sourcePath);",
            "lineNumber": 38
          }
        ]
      },
      "score": 0.3032037913799286
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/src/monitoring/logger_error_log_client.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 32
          }
        },
        "contents": "import 'dart:async';\nimport 'dart:developer';\n\nimport 'package:flutter/foundation.dart';\n\nimport 'error_log_client.dart';\n\nclass LoggerErrorLogClient implements ErrorLogClient {\n  const LoggerErrorLogClient();\n\n  static const _fatalError = 'Fatal Error';\n  static const _flutterError = 'Flutter Error';\n  static const _nonFatalError = 'Non-Fatal Error';\n\n  @override\n  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace) async {\n    log(error.toString(), name: _fatalError);\n    log(stackTrace.toString(), name: _fatalError);\n  }\n\n  @override\n  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails) async {\n    log(errorDetails.exception.toString(), name: _flutterError);\n    log(errorDetails.stack.toString(), name: _flutterError);\n  }\n\n  @override\n  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace) async {\n    log(error.toString(), name: _nonFatalError);\n    log(stackTrace.toString(), name: _nonFatalError);\n  }\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:async';",
            "lineNumber": 1
          },
          {
            "text": "import 'dart:developer';",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "import 'error_log_client.dart';",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "class LoggerErrorLogClient implements ErrorLogClient {",
            "lineNumber": 8
          },
          {
            "text": "  const LoggerErrorLogClient();",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "  static const _fatalError = 'Fatal Error';",
            "lineNumber": 11
          },
          {
            "text": "  static const _flutterError = 'Flutter Error';",
            "lineNumber": 12
          },
          {
            "text": "  static const _nonFatalError = 'Non-Fatal Error';",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "  @override",
            "lineNumber": 15
          },
          {
            "text": "  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace) async {",
            "lineNumber": 16
          },
          {
            "text": "    log(error.toString(), name: _fatalError);",
            "lineNumber": 17
          },
          {
            "text": "    log(stackTrace.toString(), name: _fatalError);",
            "lineNumber": 18
          },
          {
            "text": "  }",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "  @override",
            "lineNumber": 21
          },
          {
            "text": "  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails) async {",
            "lineNumber": 22
          },
          {
            "text": "    log(errorDetails.exception.toString(), name: _flutterError);",
            "lineNumber": 23
          },
          {
            "text": "    log(errorDetails.stack.toString(), name: _flutterError);",
            "lineNumber": 24
          },
          {
            "text": "  }",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "  @override",
            "lineNumber": 27
          },
          {
            "text": "  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace) async {",
            "lineNumber": 28
          },
          {
            "text": "    log(error.toString(), name: _nonFatalError);",
            "lineNumber": 29
          },
          {
            "text": "    log(stackTrace.toString(), name: _nonFatalError);",
            "lineNumber": 30
          },
          {
            "text": "  }",
            "lineNumber": 31
          },
          {
            "text": "}",
            "lineNumber": 32
          }
        ]
      },
      "score": 0.28302380442619324
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/src/common_widget/custom_snackbar.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 58
          }
        },
        "contents": "import 'dart:developer';\n\nimport 'package:flutter/material.dart';\n\nimport '../theme/app_color_theme.dart';\n\nenum CustomSnackbarMode { error, success, warning }\n\nclass CustomSnackbar {\n  static show(\n    BuildContext context,\n    CustomSnackbarMode mode,\n    String textContent, {\n    int durationInSeconds = 15,\n    SnackBarAction? action,\n  }) {\n    Color backgroundColor;\n\n    if (mode == CustomSnackbarMode.error) {\n      backgroundColor = AppColorTheme.alert500;\n    } else if (mode == CustomSnackbarMode.success) {\n      backgroundColor = AppColorTheme.success500;\n    } else {\n      backgroundColor = AppColorTheme.warning500;\n    }\n\n    final snackBar = SnackBar(\n      content: Text(\n        textContent,\n        style: Theme.of(context).textTheme.bodyMedium!.copyWith(\n          color: mode == CustomSnackbarMode.warning\n              ? AppColorTheme.neutral500\n              : AppColorTheme.white,\n        ),\n      ),\n      backgroundColor: backgroundColor,\n      duration: Duration(seconds: durationInSeconds),\n      action:\n          action ??\n          SnackBarAction(\n            label: 'close',\n            textColor: mode == CustomSnackbarMode.warning\n                ? AppColorTheme.neutral500\n                : AppColorTheme.white,\n            onPressed: () {\n              try {\n                ScaffoldMessenger.of(context).hideCurrentSnackBar();\n              } catch (e) {\n                log('Snackbar cannot be closed due to different context');\n              }\n            },\n          ),\n    );\n\n    ScaffoldMessenger.of(context).clearSnackBars();\n    ScaffoldMessenger.of(context).showSnackBar(snackBar);\n  }\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:developer';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "import 'package:flutter/material.dart';",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "import '../theme/app_color_theme.dart';",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "enum CustomSnackbarMode { error, success, warning }",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class CustomSnackbar {",
            "lineNumber": 9
          },
          {
            "text": "  static show(",
            "lineNumber": 10
          },
          {
            "text": "    BuildContext context,",
            "lineNumber": 11
          },
          {
            "text": "    CustomSnackbarMode mode,",
            "lineNumber": 12
          },
          {
            "text": "    String textContent, {",
            "lineNumber": 13
          },
          {
            "text": "    int durationInSeconds = 15,",
            "lineNumber": 14
          },
          {
            "text": "    SnackBarAction? action,",
            "lineNumber": 15
          },
          {
            "text": "  }) {",
            "lineNumber": 16
          },
          {
            "text": "    Color backgroundColor;",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "    if (mode == CustomSnackbarMode.error) {",
            "lineNumber": 19
          },
          {
            "text": "      backgroundColor = AppColorTheme.alert500;",
            "lineNumber": 20
          },
          {
            "text": "    } else if (mode == CustomSnackbarMode.success) {",
            "lineNumber": 21
          },
          {
            "text": "      backgroundColor = AppColorTheme.success500;",
            "lineNumber": 22
          },
          {
            "text": "    } else {",
            "lineNumber": 23
          },
          {
            "text": "      backgroundColor = AppColorTheme.warning500;",
            "lineNumber": 24
          },
          {
            "text": "    }",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "    final snackBar = SnackBar(",
            "lineNumber": 27
          },
          {
            "text": "      content: Text(",
            "lineNumber": 28
          },
          {
            "text": "        textContent,",
            "lineNumber": 29
          },
          {
            "text": "        style: Theme.of(context).textTheme.bodyMedium!.copyWith(",
            "lineNumber": 30
          },
          {
            "text": "          color: mode == CustomSnackbarMode.warning",
            "lineNumber": 31
          },
          {
            "text": "              ? AppColorTheme.neutral500",
            "lineNumber": 32
          },
          {
            "text": "              : AppColorTheme.white,",
            "lineNumber": 33
          },
          {
            "text": "        ),",
            "lineNumber": 34
          },
          {
            "text": "      ),",
            "lineNumber": 35
          },
          {
            "text": "      backgroundColor: backgroundColor,",
            "lineNumber": 36
          },
          {
            "text": "      duration: Duration(seconds: durationInSeconds),",
            "lineNumber": 37
          },
          {
            "text": "      action:",
            "lineNumber": 38
          },
          {
            "text": "          action ??",
            "lineNumber": 39
          },
          {
            "text": "          SnackBarAction(",
            "lineNumber": 40
          },
          {
            "text": "            label: 'close',",
            "lineNumber": 41
          },
          {
            "text": "            textColor: mode == CustomSnackbarMode.warning",
            "lineNumber": 42
          },
          {
            "text": "                ? AppColorTheme.neutral500",
            "lineNumber": 43
          },
          {
            "text": "                : AppColorTheme.white,",
            "lineNumber": 44
          },
          {
            "text": "            onPressed: () {",
            "lineNumber": 45
          },
          {
            "text": "              try {",
            "lineNumber": 46
          },
          {
            "text": "                ScaffoldMessenger.of(context).hideCurrentSnackBar();",
            "lineNumber": 47
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 48
          },
          {
            "text": "                log('Snackbar cannot be closed due to different context');",
            "lineNumber": 49
          },
          {
            "text": "              }",
            "lineNumber": 50
          },
          {
            "text": "            },",
            "lineNumber": 51
          },
          {
            "text": "          ),",
            "lineNumber": 52
          },
          {
            "text": "    );",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    ScaffoldMessenger.of(context).clearSnackBars();",
            "lineNumber": 55
          },
          {
            "text": "    ScaffoldMessenger.of(context).showSnackBar(snackBar);",
            "lineNumber": 56
          },
          {
            "text": "  }",
            "lineNumber": 57
          },
          {
            "text": "}",
            "lineNumber": 58
          }
        ]
      },
      "score": 0.2827433943748474
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/src/common_widget/custom_snackbar.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 58
          }
        },
        "contents": "import 'dart:developer';\n\nimport 'package:flutter/material.dart';\n\nimport '../theme/app_color_theme.dart';\n\nenum CustomSnackbarMode { error, success, warning }\n\nclass CustomSnackbar {\n  static show(\n    BuildContext context,\n    CustomSnackbarMode mode,\n    String textContent, {\n    int durationInSeconds = 15,\n    SnackBarAction? action,\n  }) {\n    Color backgroundColor;\n\n    if (mode == CustomSnackbarMode.error) {\n      backgroundColor = AppColorTheme.alert500;\n    } else if (mode == CustomSnackbarMode.success) {\n      backgroundColor = AppColorTheme.success500;\n    } else {\n      backgroundColor = AppColorTheme.warning500;\n    }\n\n    final snackBar = SnackBar(\n      content: Text(\n        textContent,\n        style: Theme.of(context).textTheme.bodyMedium!.copyWith(\n          color: mode == CustomSnackbarMode.warning\n              ? AppColorTheme.neutral500\n              : AppColorTheme.white,\n        ),\n      ),\n      backgroundColor: backgroundColor,\n      duration: Duration(seconds: durationInSeconds),\n      action:\n          action ??\n          SnackBarAction(\n            label: 'close',\n            textColor: mode == CustomSnackbarMode.warning\n                ? AppColorTheme.neutral500\n                : AppColorTheme.white,\n            onPressed: () {\n              try {\n                ScaffoldMessenger.of(context).hideCurrentSnackBar();\n              } catch (e) {\n                log('Snackbar cannot be closed due to different context');\n              }\n            },\n          ),\n    );\n\n    ScaffoldMessenger.of(context).clearSnackBars();\n    ScaffoldMessenger.of(context).showSnackBar(snackBar);\n  }\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:developer';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "import 'package:flutter/material.dart';",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "import '../theme/app_color_theme.dart';",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "enum CustomSnackbarMode { error, success, warning }",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class CustomSnackbar {",
            "lineNumber": 9
          },
          {
            "text": "  static show(",
            "lineNumber": 10
          },
          {
            "text": "    BuildContext context,",
            "lineNumber": 11
          },
          {
            "text": "    CustomSnackbarMode mode,",
            "lineNumber": 12
          },
          {
            "text": "    String textContent, {",
            "lineNumber": 13
          },
          {
            "text": "    int durationInSeconds = 15,",
            "lineNumber": 14
          },
          {
            "text": "    SnackBarAction? action,",
            "lineNumber": 15
          },
          {
            "text": "  }) {",
            "lineNumber": 16
          },
          {
            "text": "    Color backgroundColor;",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "    if (mode == CustomSnackbarMode.error) {",
            "lineNumber": 19
          },
          {
            "text": "      backgroundColor = AppColorTheme.alert500;",
            "lineNumber": 20
          },
          {
            "text": "    } else if (mode == CustomSnackbarMode.success) {",
            "lineNumber": 21
          },
          {
            "text": "      backgroundColor = AppColorTheme.success500;",
            "lineNumber": 22
          },
          {
            "text": "    } else {",
            "lineNumber": 23
          },
          {
            "text": "      backgroundColor = AppColorTheme.warning500;",
            "lineNumber": 24
          },
          {
            "text": "    }",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "    final snackBar = SnackBar(",
            "lineNumber": 27
          },
          {
            "text": "      content: Text(",
            "lineNumber": 28
          },
          {
            "text": "        textContent,",
            "lineNumber": 29
          },
          {
            "text": "        style: Theme.of(context).textTheme.bodyMedium!.copyWith(",
            "lineNumber": 30
          },
          {
            "text": "          color: mode == CustomSnackbarMode.warning",
            "lineNumber": 31
          },
          {
            "text": "              ? AppColorTheme.neutral500",
            "lineNumber": 32
          },
          {
            "text": "              : AppColorTheme.white,",
            "lineNumber": 33
          },
          {
            "text": "        ),",
            "lineNumber": 34
          },
          {
            "text": "      ),",
            "lineNumber": 35
          },
          {
            "text": "      backgroundColor: backgroundColor,",
            "lineNumber": 36
          },
          {
            "text": "      duration: Duration(seconds: durationInSeconds),",
            "lineNumber": 37
          },
          {
            "text": "      action:",
            "lineNumber": 38
          },
          {
            "text": "          action ??",
            "lineNumber": 39
          },
          {
            "text": "          SnackBarAction(",
            "lineNumber": 40
          },
          {
            "text": "            label: 'close',",
            "lineNumber": 41
          },
          {
            "text": "            textColor: mode == CustomSnackbarMode.warning",
            "lineNumber": 42
          },
          {
            "text": "                ? AppColorTheme.neutral500",
            "lineNumber": 43
          },
          {
            "text": "                : AppColorTheme.white,",
            "lineNumber": 44
          },
          {
            "text": "            onPressed: () {",
            "lineNumber": 45
          },
          {
            "text": "              try {",
            "lineNumber": 46
          },
          {
            "text": "                ScaffoldMessenger.of(context).hideCurrentSnackBar();",
            "lineNumber": 47
          },
          {
            "text": "              } catch (e) {",
            "lineNumber": 48
          },
          {
            "text": "                log('Snackbar cannot be closed due to different context');",
            "lineNumber": 49
          },
          {
            "text": "              }",
            "lineNumber": 50
          },
          {
            "text": "            },",
            "lineNumber": 51
          },
          {
            "text": "          ),",
            "lineNumber": 52
          },
          {
            "text": "    );",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "    ScaffoldMessenger.of(context).clearSnackBars();",
            "lineNumber": 55
          },
          {
            "text": "    ScaffoldMessenger.of(context).showSnackBar(snackBar);",
            "lineNumber": 56
          },
          {
            "text": "  }",
            "lineNumber": 57
          },
          {
            "text": "}",
            "lineNumber": 58
          }
        ]
      },
      "score": 0.2727659046649933
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/src/monitoring/error_log_facade.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 43
          }
        },
        "contents": "import 'package:flutter/foundation.dart';\nimport 'package:riverpod_annotation/riverpod_annotation.dart';\n\nimport '../service/firebase/crashlytics/firebase_crashlytics_client.dart';\nimport 'error_log_client.dart';\nimport 'logger_error_log_client.dart';\n\npart 'error_log_facade.g.dart';\n\nclass ErrorLogFacade implements ErrorLogClient {\n  const ErrorLogFacade(this.clients);\n  final List&lt;ErrorLogClient&gt; clients;\n\n  @override\n  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace) =&gt;\n      _dispatch((c) =&gt; c.fatalError(error, stackTrace));\n\n  @override\n  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails) =&gt;\n      _dispatch((c) =&gt; c.flutterError(errorDetails));\n\n  @override\n  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace) =&gt;\n      _dispatch((c) =&gt; c.nonFatalError(error, stackTrace));\n\n  Future&lt;void&gt; _dispatch(\n    Future&lt;void&gt; Function(ErrorLogClient client) work,\n  ) async {\n    await Future.wait(clients.map(work));\n  }\n}\n\n@Riverpod(keepAlive: true)\nErrorLogFacade errorLogFacade(Ref ref) {\n  final firebaseCrashlyticsClient = ref.watch(\n    firebaseCrashlyticsClientProvider,\n  );\n\n  return ErrorLogFacade([\n    firebaseCrashlyticsClient,\n    if (kDebugMode) const LoggerErrorLogClient(),\n  ]);\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 1
          },
          {
            "text": "import 'package:riverpod_annotation/riverpod_annotation.dart';",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "import '../service/firebase/crashlytics/firebase_crashlytics_client.dart';",
            "lineNumber": 4
          },
          {
            "text": "import 'error_log_client.dart';",
            "lineNumber": 5
          },
          {
            "text": "import 'logger_error_log_client.dart';",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "part 'error_log_facade.g.dart';",
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "class ErrorLogFacade implements ErrorLogClient {",
            "lineNumber": 10
          },
          {
            "text": "  const ErrorLogFacade(this.clients);",
            "lineNumber": 11
          },
          {
            "text": "  final List&lt;ErrorLogClient&gt; clients;",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "  @override",
            "lineNumber": 14
          },
          {
            "text": "  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace) =&gt;",
            "lineNumber": 15
          },
          {
            "text": "      _dispatch((c) =&gt; c.fatalError(error, stackTrace));",
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "  @override",
            "lineNumber": 18
          },
          {
            "text": "  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails) =&gt;",
            "lineNumber": 19
          },
          {
            "text": "      _dispatch((c) =&gt; c.flutterError(errorDetails));",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "  @override",
            "lineNumber": 22
          },
          {
            "text": "  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace) =&gt;",
            "lineNumber": 23
          },
          {
            "text": "      _dispatch((c) =&gt; c.nonFatalError(error, stackTrace));",
            "lineNumber": 24
          },
          {
            "lineNumber": 25
          },
          {
            "text": "  Future&lt;void&gt; _dispatch(",
            "lineNumber": 26
          },
          {
            "text": "    Future&lt;void&gt; Function(ErrorLogClient client) work,",
            "lineNumber": 27
          },
          {
            "text": "  ) async {",
            "lineNumber": 28
          },
          {
            "text": "    await Future.wait(clients.map(work));",
            "lineNumber": 29
          },
          {
            "text": "  }",
            "lineNumber": 30
          },
          {
            "text": "}",
            "lineNumber": 31
          },
          {
            "lineNumber": 32
          },
          {
            "text": "@Riverpod(keepAlive: true)",
            "lineNumber": 33
          },
          {
            "text": "ErrorLogFacade errorLogFacade(Ref ref) {",
            "lineNumber": 34
          },
          {
            "text": "  final firebaseCrashlyticsClient = ref.watch(",
            "lineNumber": 35
          },
          {
            "text": "    firebaseCrashlyticsClientProvider,",
            "lineNumber": 36
          },
          {
            "text": "  );",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "  return ErrorLogFacade([",
            "lineNumber": 39
          },
          {
            "text": "    firebaseCrashlyticsClient,",
            "lineNumber": 40
          },
          {
            "text": "    if (kDebugMode) const LoggerErrorLogClient(),",
            "lineNumber": 41
          },
          {
            "text": "  ]);",
            "lineNumber": 42
          },
          {
            "text": "}",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.2632136344909668
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/.cursor/rules/flutter-ui-patterns.mdc",
        "range": {
          "startPosition": {
            "line": 1413
          },
          "endPosition": {
            "line": 1470
          }
        },
        "contents": "}) async {\n  // 1. Unfocus keyboard first\n  FocusManager.instance.primaryFocus?.unfocus();\n  \n  // 2. Set show errors flag to trigger validation display\n  ref.read(helpDeskShowErrorsProvider.notifier).state = true;\n  \n  // 3. Validate form builder fields\n  if (formKey.currentState?.saveAndValidate() ?? false) {\n    try {\n      // 4. Extract form values\n      final message = formKey.currentState!.value['message'] as String?;\n      \n      // 5. Read StateProvider values (for dropdowns)\n      final firstCategory = ref.read(helpDeskCategoryProvider);\n      final secondCategory = ref.read(helpDeskSubCategoryProvider);\n      \n      // 6. Additional validation: Check all required fields\n      if (message == null ||\n          message.isEmpty ||\n          firstCategory == null ||\n          secondCategory == null) {\n        return; // Stop if validation fails\n      }\n      \n      // 7. Proceed with API call\n      await ref.watch(helpDeskControllerProvider.notifier)\n          .sendFeedback(message: message);\n      \n      // 8. Reset show errors flag on success\n      ref.read(helpDeskShowErrorsProvider.notifier).state = false;\n    } catch (e, st) {\n      CommonUtils.printAndRecordLog(e, st.toString());\n      rethrow;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**In UI Layer** (&#96;help_desk_screen.dart&#96; lines 113‑115):\n- Conditionally display validation errors based on &#96;showErrors&#96; flag and field value:\n&#96;&#96;&#96;dart\nCustomDropdownFormField(\n  // ... other properties\n  errorValidation: showErrors &amp;&amp; selectedSubCategory == null\n      ? loc.please_complete\n      : null,\n)\n&#96;&#96;&#96;\n\n**Key Points:**\n- Always unfocus keyboard before validation: &#96;FocusManager.instance.primaryFocus?.unfocus();&#96;\n- Use a &#96;StateProvider.autoDispose&lt;bool&gt;&#96; (e.g., &#96;helpDeskShowErrorsProvider&#96;) to control when validation errors are displayed\n- Set &#96;showErrors = true&#96; before validation, reset to &#96;false&#96; on successful submission\n- Validate both FormBuilder fields (&#96;saveAndValidate()&#96;) AND StateProvider values (dropdown selections)\n- Display errors conditionally: &#96;errorValidation: showErrors &amp;&amp; fieldIsInvalid ? errorMessage : null&#96;\n- Clear errors when user interacts with fields: &#96;setShowHelpDeskErrors(ref, false)&#96; in &#96;onChanged&#96; callbacks",
        "signatures": {},
        "detailedLines": [
          {
            "text": "}) async {",
            "lineNumber": 1414
          },
          {
            "text": "  // 1. Unfocus keyboard first",
            "lineNumber": 1415
          },
          {
            "text": "  FocusManager.instance.primaryFocus?.unfocus();",
            "lineNumber": 1416
          },
          {
            "text": "  ",
            "lineNumber": 1417
          },
          {
            "text": "  // 2. Set show errors flag to trigger validation display",
            "lineNumber": 1418
          },
          {
            "text": "  ref.read(helpDeskShowErrorsProvider.notifier).state = true;",
            "lineNumber": 1419
          },
          {
            "text": "  ",
            "lineNumber": 1420
          },
          {
            "text": "  // 3. Validate form builder fields",
            "lineNumber": 1421
          },
          {
            "text": "  if (formKey.currentState?.saveAndValidate() ?? false) {",
            "lineNumber": 1422
          },
          {
            "text": "    try {",
            "lineNumber": 1423
          },
          {
            "text": "      // 4. Extract form values",
            "lineNumber": 1424
          },
          {
            "text": "      final message = formKey.currentState!.value['message'] as String?;",
            "lineNumber": 1425
          },
          {
            "text": "      ",
            "lineNumber": 1426
          },
          {
            "text": "      // 5. Read StateProvider values (for dropdowns)",
            "lineNumber": 1427
          },
          {
            "text": "      final firstCategory = ref.read(helpDeskCategoryProvider);",
            "lineNumber": 1428
          },
          {
            "text": "      final secondCategory = ref.read(helpDeskSubCategoryProvider);",
            "lineNumber": 1429
          },
          {
            "text": "      ",
            "lineNumber": 1430
          },
          {
            "text": "      // 6. Additional validation: Check all required fields",
            "lineNumber": 1431
          },
          {
            "text": "      if (message == null ||",
            "lineNumber": 1432
          },
          {
            "text": "          message.isEmpty ||",
            "lineNumber": 1433
          },
          {
            "text": "          firstCategory == null ||",
            "lineNumber": 1434
          },
          {
            "text": "          secondCategory == null) {",
            "lineNumber": 1435
          },
          {
            "text": "        return; // Stop if validation fails",
            "lineNumber": 1436
          },
          {
            "text": "      }",
            "lineNumber": 1437
          },
          {
            "text": "      ",
            "lineNumber": 1438
          },
          {
            "text": "      // 7. Proceed with API call",
            "lineNumber": 1439
          },
          {
            "text": "      await ref.watch(helpDeskControllerProvider.notifier)",
            "lineNumber": 1440
          },
          {
            "text": "          .sendFeedback(message: message);",
            "lineNumber": 1441
          },
          {
            "text": "      ",
            "lineNumber": 1442
          },
          {
            "text": "      // 8. Reset show errors flag on success",
            "lineNumber": 1443
          },
          {
            "text": "      ref.read(helpDeskShowErrorsProvider.notifier).state = false;",
            "lineNumber": 1444
          },
          {
            "text": "    } catch (e, st) {",
            "lineNumber": 1445
          },
          {
            "text": "      CommonUtils.printAndRecordLog(e, st.toString());",
            "lineNumber": 1446
          },
          {
            "text": "      rethrow;",
            "lineNumber": 1447
          },
          {
            "text": "    }",
            "lineNumber": 1448
          },
          {
            "text": "  }",
            "lineNumber": 1449
          },
          {
            "text": "}",
            "lineNumber": 1450
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 1451
          },
          {
            "lineNumber": 1452
          },
          {
            "text": "**In UI Layer** (&#96;help_desk_screen.dart&#96; lines 113‑115):",
            "lineNumber": 1453
          },
          {
            "text": "- Conditionally display validation errors based on &#96;showErrors&#96; flag and field value:",
            "lineNumber": 1454
          },
          {
            "text": "&#96;&#96;&#96;dart",
            "lineNumber": 1455
          },
          {
            "text": "CustomDropdownFormField(",
            "lineNumber": 1456
          },
          {
            "text": "  // ... other properties",
            "lineNumber": 1457
          },
          {
            "text": "  errorValidation: showErrors &amp;&amp; selectedSubCategory == null",
            "lineNumber": 1458
          },
          {
            "text": "      ? loc.please_complete",
            "lineNumber": 1459
          },
          {
            "text": "      : null,",
            "lineNumber": 1460
          },
          {
            "text": ")",
            "lineNumber": 1461
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 1462
          },
          {
            "lineNumber": 1463
          },
          {
            "text": "**Key Points:**",
            "lineNumber": 1464
          },
          {
            "text": "- Always unfocus keyboard before validation: &#96;FocusManager.instance.primaryFocus?.unfocus();&#96;",
            "lineNumber": 1465
          },
          {
            "text": "- Use a &#96;StateProvider.autoDispose&lt;bool&gt;&#96; (e.g., &#96;helpDeskShowErrorsProvider&#96;) to control when validation errors are displayed",
            "lineNumber": 1466
          },
          {
            "text": "- Set &#96;showErrors = true&#96; before validation, reset to &#96;false&#96; on successful submission",
            "lineNumber": 1467
          },
          {
            "text": "- Validate both FormBuilder fields (&#96;saveAndValidate()&#96;) AND StateProvider values (dropdown selections)",
            "lineNumber": 1468
          },
          {
            "text": "- Display errors conditionally: &#96;errorValidation: showErrors &amp;&amp; fieldIsInvalid ? errorMessage : null&#96;",
            "lineNumber": 1469
          },
          {
            "text": "- Clear errors when user interacts with fields: &#96;setShowHelpDeskErrors(ref, false)&#96; in &#96;onChanged&#96; callbacks",
            "lineNumber": 1470
          }
        ]
      },
      "score": 0.2628228962421417
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/src/utils/common_utils.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 64
          }
        },
        "contents": "import 'dart:convert';\nimport 'dart:developer';\n{{^use_sentry}}{{#use_firebase}}import 'package:firebase_crashlytics/firebase_crashlytics.dart';{{/use_firebase}}{{/use_sentry}}\n{{#use_sentry}}import 'package:sentry_flutter/sentry_flutter.dart';{{/use_sentry}}\n\nclass CommonUtils {\n  static void printAndRecordLog(dynamic error, String stackTrace) {\n    // Log to console\n    log(error.toString());\n    log(stackTrace);\n    \n    {{^use_sentry}}{{#use_firebase}}\n    // Record non-fatal error to Crashlytics\n    FirebaseCrashlytics.instance.recordError(\n      error,\n      StackTrace.fromString(stackTrace),\n      printDetails: false,\n    );\n    {{/use_firebase}}{{/use_sentry}}\n\n    {{#use_sentry}}\n    // Record error to Sentry\n    Sentry.captureException(error, stackTrace: stackTrace);\n    {{/use_sentry}}\n  }\n\n  static Map&lt;String, dynamic&gt; decodeTokenAsJson(String code) {\n    final normalizedSource = base64Url.normalize(code.split(\".\")[1]);\n    final result = utf8.decode(base64Url.decode(normalizedSource));\n\n    return json.decode(result);\n  }\n\n  static bool isEmpty(dynamic value) {\n    if (value == null ||\n        value == '' ||\n        value == 'null' ||\n        value.isEmpty ||\n        value.length == 0) {\n      return true;\n    }\n    return false;\n  }\n\n  /// Adds thousands separators to a numeric string.\n  ///\n  /// This method takes a string representation of a number and adds a separator\n  /// character every three digits from the right. It handles negative numbers\n  /// by preserving the negative sign.\n  ///\n  /// Parameters:\n  /// * [value] - The numeric string to format (e.g., \"1234567\" or \"-1234567\")\n  /// * [separator] - The character to use as thousands separator (defaults to ',')\n  ///\n  /// Returns a [String] with thousands separators added.\n  ///\n  /// Example:\n  /// &#96;&#96;&#96;dart\n  /// String formatted = CommonUtils.addThousandsSeparator(\"1234567\");\n  /// print(formatted); // Output: \"1,234,567\"\n  ///\n  /// String negativeFormatted = CommonUtils.addThousandsSeparator(\"-1234567\");\n  /// print(negativeFormatted); // Output: \"-1,234,567\"\n  ///",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:convert';",
            "lineNumber": 1
          },
          {
            "text": "import 'dart:developer';",
            "lineNumber": 2
          },
          {
            "text": "{{^use_sentry}}{{#use_firebase}}import 'package:firebase_crashlytics/firebase_crashlytics.dart';{{/use_firebase}}{{/use_sentry}}",
            "lineNumber": 3
          },
          {
            "text": "{{#use_sentry}}import 'package:sentry_flutter/sentry_flutter.dart';{{/use_sentry}}",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "class CommonUtils {",
            "lineNumber": 6
          },
          {
            "text": "  static void printAndRecordLog(dynamic error, String stackTrace) {",
            "lineNumber": 7
          },
          {
            "text": "    // Log to console",
            "lineNumber": 8
          },
          {
            "text": "    log(error.toString());",
            "lineNumber": 9
          },
          {
            "text": "    log(stackTrace);",
            "lineNumber": 10
          },
          {
            "text": "    ",
            "lineNumber": 11
          },
          {
            "text": "    {{^use_sentry}}{{#use_firebase}}",
            "lineNumber": 12
          },
          {
            "text": "    // Record non-fatal error to Crashlytics",
            "lineNumber": 13
          },
          {
            "text": "    FirebaseCrashlytics.instance.recordError(",
            "lineNumber": 14
          },
          {
            "text": "      error,",
            "lineNumber": 15
          },
          {
            "text": "      StackTrace.fromString(stackTrace),",
            "lineNumber": 16
          },
          {
            "text": "      printDetails: false,",
            "lineNumber": 17
          },
          {
            "text": "    );",
            "lineNumber": 18
          },
          {
            "text": "    {{/use_firebase}}{{/use_sentry}}",
            "lineNumber": 19
          },
          {
            "lineNumber": 20
          },
          {
            "text": "    {{#use_sentry}}",
            "lineNumber": 21
          },
          {
            "text": "    // Record error to Sentry",
            "lineNumber": 22
          },
          {
            "text": "    Sentry.captureException(error, stackTrace: stackTrace);",
            "lineNumber": 23
          },
          {
            "text": "    {{/use_sentry}}",
            "lineNumber": 24
          },
          {
            "text": "  }",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "  static Map&lt;String, dynamic&gt; decodeTokenAsJson(String code) {",
            "lineNumber": 27
          },
          {
            "text": "    final normalizedSource = base64Url.normalize(code.split(\".\")[1]);",
            "lineNumber": 28
          },
          {
            "text": "    final result = utf8.decode(base64Url.decode(normalizedSource));",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "    return json.decode(result);",
            "lineNumber": 31
          },
          {
            "text": "  }",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "  static bool isEmpty(dynamic value) {",
            "lineNumber": 34
          },
          {
            "text": "    if (value == null ||",
            "lineNumber": 35
          },
          {
            "text": "        value == '' ||",
            "lineNumber": 36
          },
          {
            "text": "        value == 'null' ||",
            "lineNumber": 37
          },
          {
            "text": "        value.isEmpty ||",
            "lineNumber": 38
          },
          {
            "text": "        value.length == 0) {",
            "lineNumber": 39
          },
          {
            "text": "      return true;",
            "lineNumber": 40
          },
          {
            "text": "    }",
            "lineNumber": 41
          },
          {
            "text": "    return false;",
            "lineNumber": 42
          },
          {
            "text": "  }",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "  /// Adds thousands separators to a numeric string.",
            "lineNumber": 45
          },
          {
            "text": "  ///",
            "lineNumber": 46
          },
          {
            "text": "  /// This method takes a string representation of a number and adds a separator",
            "lineNumber": 47
          },
          {
            "text": "  /// character every three digits from the right. It handles negative numbers",
            "lineNumber": 48
          },
          {
            "text": "  /// by preserving the negative sign.",
            "lineNumber": 49
          },
          {
            "text": "  ///",
            "lineNumber": 50
          },
          {
            "text": "  /// Parameters:",
            "lineNumber": 51
          },
          {
            "text": "  /// * [value] - The numeric string to format (e.g., \"1234567\" or \"-1234567\")",
            "lineNumber": 52
          },
          {
            "text": "  /// * [separator] - The character to use as thousands separator (defaults to ',')",
            "lineNumber": 53
          },
          {
            "text": "  ///",
            "lineNumber": 54
          },
          {
            "text": "  /// Returns a [String] with thousands separators added.",
            "lineNumber": 55
          },
          {
            "text": "  ///",
            "lineNumber": 56
          },
          {
            "text": "  /// Example:",
            "lineNumber": 57
          },
          {
            "text": "  /// &#96;&#96;&#96;dart",
            "lineNumber": 58
          },
          {
            "text": "  /// String formatted = CommonUtils.addThousandsSeparator(\"1234567\");",
            "lineNumber": 59
          },
          {
            "text": "  /// print(formatted); // Output: \"1,234,567\"",
            "lineNumber": 60
          },
          {
            "text": "  ///",
            "lineNumber": 61
          },
          {
            "text": "  /// String negativeFormatted = CommonUtils.addThousandsSeparator(\"-1234567\");",
            "lineNumber": 62
          },
          {
            "text": "  /// print(negativeFormatted); // Output: \"-1,234,567\"",
            "lineNumber": 63
          },
          {
            "text": "  ///",
            "lineNumber": 64
          }
        ]
      },
      "score": 0.26159441471099854
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/hooks/pre_gen.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 51
          }
        },
        "contents": "import 'package:mason/mason.dart';\n\nFuture&lt;void&gt; run(HookContext context) async {\n  final progress = context.logger.progress('Prepare project');\n\n  final useFirebase = context.vars['use_firebase'] as bool? ?? false;\n  if (useFirebase) {\n    String? firebaseProjectId = context.vars['firebase_project_id'] as String?;\n    // Prompt for Firebase project ID\n    if (firebaseProjectId == null || firebaseProjectId.isEmpty) {\n      // Only prompt if not already provided\n      firebaseProjectId = context.logger.prompt(\n        'Enter your Firebase project ID:',\n        defaultValue: '',\n      );\n    }\n    context.vars['firebase_project_id'] = firebaseProjectId;\n  }\n\n  final useSentry = context.vars['use_sentry'] as bool? ?? false;\n  if (useSentry) {\n    String? sentryDsn = context.vars['sentry_dsn'] as String?;\n    // Prompt for Sentry DSN\n    if (sentryDsn == null || sentryDsn.isEmpty) {\n      // Only prompt if not already provided\n      sentryDsn = context.logger.prompt(\n        'Enter your Sentry DSN:',\n        defaultValue: '',\n      );\n    }\n    context.vars['sentry_dsn'] = sentryDsn;\n  }\n\n  final useMixpanel = context.vars['use_mixpanel'] as bool? ?? false;\n  if (useMixpanel) {\n    String? mixpanelToken = context.vars['mixpanel_token'] as String?;\n    // Prompt for Mixpanel token\n    if (mixpanelToken == null || mixpanelToken.isEmpty) {\n      // Only prompt if not already provided\n      mixpanelToken = context.logger.prompt(\n        'Enter your Mixpanel token:',\n        defaultValue: '',\n      );\n    }\n    context.vars['mixpanel_token'] = mixpanelToken;\n  }\n\n  // Check if custom_icon is true\n  final customIcon = context.vars['custom_icon'] as bool? ?? false;\n  if (customIcon) {\n    String? iconPath = context.vars['app_icon_path'] as String?;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:mason/mason.dart';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "Future&lt;void&gt; run(HookContext context) async {",
            "lineNumber": 3
          },
          {
            "text": "  final progress = context.logger.progress('Prepare project');",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "  final useFirebase = context.vars['use_firebase'] as bool? ?? false;",
            "lineNumber": 6
          },
          {
            "text": "  if (useFirebase) {",
            "lineNumber": 7
          },
          {
            "text": "    String? firebaseProjectId = context.vars['firebase_project_id'] as String?;",
            "lineNumber": 8
          },
          {
            "text": "    // Prompt for Firebase project ID",
            "lineNumber": 9
          },
          {
            "text": "    if (firebaseProjectId == null || firebaseProjectId.isEmpty) {",
            "lineNumber": 10
          },
          {
            "text": "      // Only prompt if not already provided",
            "lineNumber": 11
          },
          {
            "text": "      firebaseProjectId = context.logger.prompt(",
            "lineNumber": 12
          },
          {
            "text": "        'Enter your Firebase project ID:',",
            "lineNumber": 13
          },
          {
            "text": "        defaultValue: '',",
            "lineNumber": 14
          },
          {
            "text": "      );",
            "lineNumber": 15
          },
          {
            "text": "    }",
            "lineNumber": 16
          },
          {
            "text": "    context.vars['firebase_project_id'] = firebaseProjectId;",
            "lineNumber": 17
          },
          {
            "text": "  }",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "text": "  final useSentry = context.vars['use_sentry'] as bool? ?? false;",
            "lineNumber": 20
          },
          {
            "text": "  if (useSentry) {",
            "lineNumber": 21
          },
          {
            "text": "    String? sentryDsn = context.vars['sentry_dsn'] as String?;",
            "lineNumber": 22
          },
          {
            "text": "    // Prompt for Sentry DSN",
            "lineNumber": 23
          },
          {
            "text": "    if (sentryDsn == null || sentryDsn.isEmpty) {",
            "lineNumber": 24
          },
          {
            "text": "      // Only prompt if not already provided",
            "lineNumber": 25
          },
          {
            "text": "      sentryDsn = context.logger.prompt(",
            "lineNumber": 26
          },
          {
            "text": "        'Enter your Sentry DSN:',",
            "lineNumber": 27
          },
          {
            "text": "        defaultValue: '',",
            "lineNumber": 28
          },
          {
            "text": "      );",
            "lineNumber": 29
          },
          {
            "text": "    }",
            "lineNumber": 30
          },
          {
            "text": "    context.vars['sentry_dsn'] = sentryDsn;",
            "lineNumber": 31
          },
          {
            "text": "  }",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "  final useMixpanel = context.vars['use_mixpanel'] as bool? ?? false;",
            "lineNumber": 34
          },
          {
            "text": "  if (useMixpanel) {",
            "lineNumber": 35
          },
          {
            "text": "    String? mixpanelToken = context.vars['mixpanel_token'] as String?;",
            "lineNumber": 36
          },
          {
            "text": "    // Prompt for Mixpanel token",
            "lineNumber": 37
          },
          {
            "text": "    if (mixpanelToken == null || mixpanelToken.isEmpty) {",
            "lineNumber": 38
          },
          {
            "text": "      // Only prompt if not already provided",
            "lineNumber": 39
          },
          {
            "text": "      mixpanelToken = context.logger.prompt(",
            "lineNumber": 40
          },
          {
            "text": "        'Enter your Mixpanel token:',",
            "lineNumber": 41
          },
          {
            "text": "        defaultValue: '',",
            "lineNumber": 42
          },
          {
            "text": "      );",
            "lineNumber": 43
          },
          {
            "text": "    }",
            "lineNumber": 44
          },
          {
            "text": "    context.vars['mixpanel_token'] = mixpanelToken;",
            "lineNumber": 45
          },
          {
            "text": "  }",
            "lineNumber": 46
          },
          {
            "lineNumber": 47
          },
          {
            "text": "  // Check if custom_icon is true",
            "lineNumber": 48
          },
          {
            "text": "  final customIcon = context.vars['custom_icon'] as bool? ?? false;",
            "lineNumber": 49
          },
          {
            "text": "  if (customIcon) {",
            "lineNumber": 50
          },
          {
            "text": "    String? iconPath = context.vars['app_icon_path'] as String?;",
            "lineNumber": 51
          }
        ]
      },
      "score": 0.25753891468048096
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/.cursor/rules/flutter-ui-patterns.mdc",
        "range": {
          "startPosition": {
            "line": 1413
          },
          "endPosition": {
            "line": 1470
          }
        },
        "contents": "}) async {\n  // 1. Unfocus keyboard first\n  FocusManager.instance.primaryFocus?.unfocus();\n  \n  // 2. Set show errors flag to trigger validation display\n  ref.read(helpDeskShowErrorsProvider.notifier).state = true;\n  \n  // 3. Validate form builder fields\n  if (formKey.currentState?.saveAndValidate() ?? false) {\n    try {\n      // 4. Extract form values\n      final message = formKey.currentState!.value['message'] as String?;\n      \n      // 5. Read StateProvider values (for dropdowns)\n      final firstCategory = ref.read(helpDeskCategoryProvider);\n      final secondCategory = ref.read(helpDeskSubCategoryProvider);\n      \n      // 6. Additional validation: Check all required fields\n      if (message == null ||\n          message.isEmpty ||\n          firstCategory == null ||\n          secondCategory == null) {\n        return; // Stop if validation fails\n      }\n      \n      // 7. Proceed with API call\n      await ref.watch(helpDeskControllerProvider.notifier)\n          .sendFeedback(message: message);\n      \n      // 8. Reset show errors flag on success\n      ref.read(helpDeskShowErrorsProvider.notifier).state = false;\n    } catch (e, st) {\n      CommonUtils.printAndRecordLog(e, st.toString());\n      rethrow;\n    }\n  }\n}\n&#96;&#96;&#96;\n\n**In UI Layer** (&#96;help_desk_screen.dart&#96; lines 113‑115):\n- Conditionally display validation errors based on &#96;showErrors&#96; flag and field value:\n&#96;&#96;&#96;dart\nCustomDropdownFormField(\n  // ... other properties\n  errorValidation: showErrors &amp;&amp; selectedSubCategory == null\n      ? loc.please_complete\n      : null,\n)\n&#96;&#96;&#96;\n\n**Key Points:**\n- Always unfocus keyboard before validation: &#96;FocusManager.instance.primaryFocus?.unfocus();&#96;\n- Use a &#96;StateProvider.autoDispose&lt;bool&gt;&#96; (e.g., &#96;helpDeskShowErrorsProvider&#96;) to control when validation errors are displayed\n- Set &#96;showErrors = true&#96; before validation, reset to &#96;false&#96; on successful submission\n- Validate both FormBuilder fields (&#96;saveAndValidate()&#96;) AND StateProvider values (dropdown selections)\n- Display errors conditionally: &#96;errorValidation: showErrors &amp;&amp; fieldIsInvalid ? errorMessage : null&#96;\n- Clear errors when user interacts with fields: &#96;setShowHelpDeskErrors(ref, false)&#96; in &#96;onChanged&#96; callbacks",
        "signatures": {},
        "detailedLines": [
          {
            "text": "}) async {",
            "lineNumber": 1414
          },
          {
            "text": "  // 1. Unfocus keyboard first",
            "lineNumber": 1415
          },
          {
            "text": "  FocusManager.instance.primaryFocus?.unfocus();",
            "lineNumber": 1416
          },
          {
            "text": "  ",
            "lineNumber": 1417
          },
          {
            "text": "  // 2. Set show errors flag to trigger validation display",
            "lineNumber": 1418
          },
          {
            "text": "  ref.read(helpDeskShowErrorsProvider.notifier).state = true;",
            "lineNumber": 1419
          },
          {
            "text": "  ",
            "lineNumber": 1420
          },
          {
            "text": "  // 3. Validate form builder fields",
            "lineNumber": 1421
          },
          {
            "text": "  if (formKey.currentState?.saveAndValidate() ?? false) {",
            "lineNumber": 1422
          },
          {
            "text": "    try {",
            "lineNumber": 1423
          },
          {
            "text": "      // 4. Extract form values",
            "lineNumber": 1424
          },
          {
            "text": "      final message = formKey.currentState!.value['message'] as String?;",
            "lineNumber": 1425
          },
          {
            "text": "      ",
            "lineNumber": 1426
          },
          {
            "text": "      // 5. Read StateProvider values (for dropdowns)",
            "lineNumber": 1427
          },
          {
            "text": "      final firstCategory = ref.read(helpDeskCategoryProvider);",
            "lineNumber": 1428
          },
          {
            "text": "      final secondCategory = ref.read(helpDeskSubCategoryProvider);",
            "lineNumber": 1429
          },
          {
            "text": "      ",
            "lineNumber": 1430
          },
          {
            "text": "      // 6. Additional validation: Check all required fields",
            "lineNumber": 1431
          },
          {
            "text": "      if (message == null ||",
            "lineNumber": 1432
          },
          {
            "text": "          message.isEmpty ||",
            "lineNumber": 1433
          },
          {
            "text": "          firstCategory == null ||",
            "lineNumber": 1434
          },
          {
            "text": "          secondCategory == null) {",
            "lineNumber": 1435
          },
          {
            "text": "        return; // Stop if validation fails",
            "lineNumber": 1436
          },
          {
            "text": "      }",
            "lineNumber": 1437
          },
          {
            "text": "      ",
            "lineNumber": 1438
          },
          {
            "text": "      // 7. Proceed with API call",
            "lineNumber": 1439
          },
          {
            "text": "      await ref.watch(helpDeskControllerProvider.notifier)",
            "lineNumber": 1440
          },
          {
            "text": "          .sendFeedback(message: message);",
            "lineNumber": 1441
          },
          {
            "text": "      ",
            "lineNumber": 1442
          },
          {
            "text": "      // 8. Reset show errors flag on success",
            "lineNumber": 1443
          },
          {
            "text": "      ref.read(helpDeskShowErrorsProvider.notifier).state = false;",
            "lineNumber": 1444
          },
          {
            "text": "    } catch (e, st) {",
            "lineNumber": 1445
          },
          {
            "text": "      CommonUtils.printAndRecordLog(e, st.toString());",
            "lineNumber": 1446
          },
          {
            "text": "      rethrow;",
            "lineNumber": 1447
          },
          {
            "text": "    }",
            "lineNumber": 1448
          },
          {
            "text": "  }",
            "lineNumber": 1449
          },
          {
            "text": "}",
            "lineNumber": 1450
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 1451
          },
          {
            "lineNumber": 1452
          },
          {
            "text": "**In UI Layer** (&#96;help_desk_screen.dart&#96; lines 113‑115):",
            "lineNumber": 1453
          },
          {
            "text": "- Conditionally display validation errors based on &#96;showErrors&#96; flag and field value:",
            "lineNumber": 1454
          },
          {
            "text": "&#96;&#96;&#96;dart",
            "lineNumber": 1455
          },
          {
            "text": "CustomDropdownFormField(",
            "lineNumber": 1456
          },
          {
            "text": "  // ... other properties",
            "lineNumber": 1457
          },
          {
            "text": "  errorValidation: showErrors &amp;&amp; selectedSubCategory == null",
            "lineNumber": 1458
          },
          {
            "text": "      ? loc.please_complete",
            "lineNumber": 1459
          },
          {
            "text": "      : null,",
            "lineNumber": 1460
          },
          {
            "text": ")",
            "lineNumber": 1461
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 1462
          },
          {
            "lineNumber": 1463
          },
          {
            "text": "**Key Points:**",
            "lineNumber": 1464
          },
          {
            "text": "- Always unfocus keyboard before validation: &#96;FocusManager.instance.primaryFocus?.unfocus();&#96;",
            "lineNumber": 1465
          },
          {
            "text": "- Use a &#96;StateProvider.autoDispose&lt;bool&gt;&#96; (e.g., &#96;helpDeskShowErrorsProvider&#96;) to control when validation errors are displayed",
            "lineNumber": 1466
          },
          {
            "text": "- Set &#96;showErrors = true&#96; before validation, reset to &#96;false&#96; on successful submission",
            "lineNumber": 1467
          },
          {
            "text": "- Validate both FormBuilder fields (&#96;saveAndValidate()&#96;) AND StateProvider values (dropdown selections)",
            "lineNumber": 1468
          },
          {
            "text": "- Display errors conditionally: &#96;errorValidation: showErrors &amp;&amp; fieldIsInvalid ? errorMessage : null&#96;",
            "lineNumber": 1469
          },
          {
            "text": "- Clear errors when user interacts with fields: &#96;setShowHelpDeskErrors(ref, false)&#96; in &#96;onChanged&#96; callbacks",
            "lineNumber": 1470
          }
        ]
      },
      "score": 0.2454729974269867
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/src/common_widget/async_value_widget.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 55
          }
        },
        "contents": "import 'package:flutter/foundation.dart';\nimport 'package:flutter/material.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\n\nimport '../../flavor.dart';\nimport '../constant/error_message.dart';\nimport '../monitoring/error_log_facade.dart';\n\nclass AsyncValueWidget&lt;T&gt; extends ConsumerWidget {\n  const AsyncValueWidget({\n    super.key,\n    required this.value,\n    required this.data,\n    this.customLoading,\n    this.onError,\n    this.skipRefreshLoading = true,\n    this.skipError = false,\n  });\n  final AsyncValue&lt;T&gt; value;\n  final Widget Function(T) data;\n  final Widget? customLoading;\n  final Widget Function(Object, StackTrace)? onError;\n  final bool skipRefreshLoading;\n  final bool skipError;\n\n  @override\n  Widget build(BuildContext context, WidgetRef ref) {\n    return value.when(\n      data: data,\n      skipLoadingOnRefresh: skipRefreshLoading,\n      skipError: skipError,\n      error:\n          onError ??\n          (e, st) {\n            ref.read(errorLogFacadeProvider).nonFatalError(e, st);\n\n            final isPrd = kReleaseMode || F.appFlavor == Flavor.prod;\n\n            final errorMsg =\n                e != ErrorMessage.noInternetMsg &amp;&amp;\n                    e != ErrorMessage.requestTimeoutMsg\n                ? '$e\\n\\n$st'\n                : '$e';\n\n            return Center(\n              child: Text(\n                isPrd ? ErrorMessage.defaultUnParseErrorMsg : errorMsg,\n              ),\n            );\n          },\n      loading: () =&gt;\n          Center(child: customLoading ?? const CircularProgressIndicator()),\n    );\n  }\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 1
          },
          {
            "text": "import 'package:flutter/material.dart';",
            "lineNumber": 2
          },
          {
            "text": "import 'package:flutter_riverpod/flutter_riverpod.dart';",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "import '../../flavor.dart';",
            "lineNumber": 5
          },
          {
            "text": "import '../constant/error_message.dart';",
            "lineNumber": 6
          },
          {
            "text": "import '../monitoring/error_log_facade.dart';",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class AsyncValueWidget&lt;T&gt; extends ConsumerWidget {",
            "lineNumber": 9
          },
          {
            "text": "  const AsyncValueWidget({",
            "lineNumber": 10
          },
          {
            "text": "    super.key,",
            "lineNumber": 11
          },
          {
            "text": "    required this.value,",
            "lineNumber": 12
          },
          {
            "text": "    required this.data,",
            "lineNumber": 13
          },
          {
            "text": "    this.customLoading,",
            "lineNumber": 14
          },
          {
            "text": "    this.onError,",
            "lineNumber": 15
          },
          {
            "text": "    this.skipRefreshLoading = true,",
            "lineNumber": 16
          },
          {
            "text": "    this.skipError = false,",
            "lineNumber": 17
          },
          {
            "text": "  });",
            "lineNumber": 18
          },
          {
            "text": "  final AsyncValue&lt;T&gt; value;",
            "lineNumber": 19
          },
          {
            "text": "  final Widget Function(T) data;",
            "lineNumber": 20
          },
          {
            "text": "  final Widget? customLoading;",
            "lineNumber": 21
          },
          {
            "text": "  final Widget Function(Object, StackTrace)? onError;",
            "lineNumber": 22
          },
          {
            "text": "  final bool skipRefreshLoading;",
            "lineNumber": 23
          },
          {
            "text": "  final bool skipError;",
            "lineNumber": 24
          },
          {
            "lineNumber": 25
          },
          {
            "text": "  @override",
            "lineNumber": 26
          },
          {
            "text": "  Widget build(BuildContext context, WidgetRef ref) {",
            "lineNumber": 27
          },
          {
            "text": "    return value.when(",
            "lineNumber": 28
          },
          {
            "text": "      data: data,",
            "lineNumber": 29
          },
          {
            "text": "      skipLoadingOnRefresh: skipRefreshLoading,",
            "lineNumber": 30
          },
          {
            "text": "      skipError: skipError,",
            "lineNumber": 31
          },
          {
            "text": "      error:",
            "lineNumber": 32
          },
          {
            "text": "          onError ??",
            "lineNumber": 33
          },
          {
            "text": "          (e, st) {",
            "lineNumber": 34
          },
          {
            "text": "            ref.read(errorLogFacadeProvider).nonFatalError(e, st);",
            "lineNumber": 35
          },
          {
            "lineNumber": 36
          },
          {
            "text": "            final isPrd = kReleaseMode || F.appFlavor == Flavor.prod;",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "            final errorMsg =",
            "lineNumber": 39
          },
          {
            "text": "                e != ErrorMessage.noInternetMsg &amp;&amp;",
            "lineNumber": 40
          },
          {
            "text": "                    e != ErrorMessage.requestTimeoutMsg",
            "lineNumber": 41
          },
          {
            "text": "                ? '$e\\n\\n$st'",
            "lineNumber": 42
          },
          {
            "text": "                : '$e';",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "            return Center(",
            "lineNumber": 45
          },
          {
            "text": "              child: Text(",
            "lineNumber": 46
          },
          {
            "text": "                isPrd ? ErrorMessage.defaultUnParseErrorMsg : errorMsg,",
            "lineNumber": 47
          },
          {
            "text": "              ),",
            "lineNumber": 48
          },
          {
            "text": "            );",
            "lineNumber": 49
          },
          {
            "text": "          },",
            "lineNumber": 50
          },
          {
            "text": "      loading: () =&gt;",
            "lineNumber": 51
          },
          {
            "text": "          Center(child: customLoading ?? const CircularProgressIndicator()),",
            "lineNumber": 52
          },
          {
            "text": "    );",
            "lineNumber": 53
          },
          {
            "text": "  }",
            "lineNumber": 54
          },
          {
            "text": "}",
            "lineNumber": 55
          }
        ]
      },
      "score": 0.22633635997772217
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/.cursor/rules/flutter-ui-patterns.mdc",
        "range": {
          "startPosition": {
            "line": 118
          },
          "endPosition": {
            "line": 171
          }
        },
        "contents": "### Rules\n\n1. **&#96;ref.watch()&#96; and &#96;ref.read()&#96;**: Must be encapsulated in state/event mixins\n   - Create methods in &#96;*_state.dart&#96; mixins for &#96;ref.watch()&#96; calls\n   - Create methods in &#96;*_event.dart&#96; mixins for &#96;ref.read()&#96; calls\n   - Call these mixin methods from the UI layer\n\n2. **&#96;ref.listen()&#96;**: Allowed in UI layer for side effects\n   - Use for showing snackbars, navigation callbacks, handling async results, etc.\n   - Must be called in the &#96;build&#96; method, typically at the beginning after getting localization\n\n### Listening to Async Results\n\nWhen listening to controller providers that return &#96;AsyncValue&#96;, use this pattern to handle errors and success states:\n\n**Pattern for Async Operations** (&#96;forgot_password_screen.dart&#96; lines 30‑49):\n&#96;&#96;&#96;dart\nref.listen&lt;AsyncValue&gt;(forgotPasswordControllerProvider, (prev, next) {\n  // Handle error state\n  if (next is AsyncError) {\n    if (!next.isRefreshing &amp;&amp; next.hasError) {\n      CustomSnackbar.show(\n        context,\n        CustomSnackbarMode.error,\n        next.error.toString(),\n      );\n    }\n  }\n  // Handle success state (transition from loading to data)\n  else if (next is AsyncData &amp;&amp; prev is AsyncLoading) {\n    if (context.mounted) {\n      CustomSnackbar.show(\n        context,\n        CustomSnackbarMode.success,\n        next.value?.message ?? '',\n      );\n      context.pop(); // Navigate back on success\n    }\n  }\n});\n&#96;&#96;&#96;\n\n**Key Points:**\n- **Error handling**: Check &#96;next is AsyncError&#96; and &#96;!next.isRefreshing&#96; to avoid showing errors during refresh\n- **Success handling**: Check &#96;next is AsyncData &amp;&amp; prev is AsyncLoading&#96; to detect successful completion\n- **Context safety**: Always check &#96;context.mounted&#96; before navigation or context-dependent operations\n- **Message extraction**: Use &#96;next.value?.message&#96; for API response messages, or provide fallback strings\n- **Navigation**: Use &#96;context.pop()&#96; or &#96;goToXxx(ref)&#96; from event mixins after successful operations\n\n**Additional Examples:**\n- &#96;help_desk_screen.dart&#96; lines 36‑54: Help desk form submission\n- &#96;account_screen.dart&#96; lines 36‑54: Logout operation",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### Rules",
            "lineNumber": 120
          },
          {
            "lineNumber": 121
          },
          {
            "text": "1. **&#96;ref.watch()&#96; and &#96;ref.read()&#96;**: Must be encapsulated in state/event mixins",
            "lineNumber": 122
          },
          {
            "text": "   - Create methods in &#96;*_state.dart&#96; mixins for &#96;ref.watch()&#96; calls",
            "lineNumber": 123
          },
          {
            "text": "   - Create methods in &#96;*_event.dart&#96; mixins for &#96;ref.read()&#96; calls",
            "lineNumber": 124
          },
          {
            "text": "   - Call these mixin methods from the UI layer",
            "lineNumber": 125
          },
          {
            "lineNumber": 126
          },
          {
            "text": "2. **&#96;ref.listen()&#96;**: Allowed in UI layer for side effects",
            "lineNumber": 127
          },
          {
            "text": "   - Use for showing snackbars, navigation callbacks, handling async results, etc.",
            "lineNumber": 128
          },
          {
            "text": "   - Must be called in the &#96;build&#96; method, typically at the beginning after getting localization",
            "lineNumber": 129
          },
          {
            "lineNumber": 130
          },
          {
            "text": "### Listening to Async Results",
            "lineNumber": 131
          },
          {
            "lineNumber": 132
          },
          {
            "text": "When listening to controller providers that return &#96;AsyncValue&#96;, use this pattern to handle errors and success states:",
            "lineNumber": 133
          },
          {
            "lineNumber": 134
          },
          {
            "text": "**Pattern for Async Operations** (&#96;forgot_password_screen.dart&#96; lines 30‑49):",
            "lineNumber": 135
          },
          {
            "text": "&#96;&#96;&#96;dart",
            "lineNumber": 136
          },
          {
            "text": "ref.listen&lt;AsyncValue&gt;(forgotPasswordControllerProvider, (prev, next) {",
            "lineNumber": 137
          },
          {
            "text": "  // Handle error state",
            "lineNumber": 138
          },
          {
            "text": "  if (next is AsyncError) {",
            "lineNumber": 139
          },
          {
            "text": "    if (!next.isRefreshing &amp;&amp; next.hasError) {",
            "lineNumber": 140
          },
          {
            "text": "      CustomSnackbar.show(",
            "lineNumber": 141
          },
          {
            "text": "        context,",
            "lineNumber": 142
          },
          {
            "text": "        CustomSnackbarMode.error,",
            "lineNumber": 143
          },
          {
            "text": "        next.error.toString(),",
            "lineNumber": 144
          },
          {
            "text": "      );",
            "lineNumber": 145
          },
          {
            "text": "    }",
            "lineNumber": 146
          },
          {
            "text": "  }",
            "lineNumber": 147
          },
          {
            "text": "  // Handle success state (transition from loading to data)",
            "lineNumber": 148
          },
          {
            "text": "  else if (next is AsyncData &amp;&amp; prev is AsyncLoading) {",
            "lineNumber": 149
          },
          {
            "text": "    if (context.mounted) {",
            "lineNumber": 150
          },
          {
            "text": "      CustomSnackbar.show(",
            "lineNumber": 151
          },
          {
            "text": "        context,",
            "lineNumber": 152
          },
          {
            "text": "        CustomSnackbarMode.success,",
            "lineNumber": 153
          },
          {
            "text": "        next.value?.message ?? '',",
            "lineNumber": 154
          },
          {
            "text": "      );",
            "lineNumber": 155
          },
          {
            "text": "      context.pop(); // Navigate back on success",
            "lineNumber": 156
          },
          {
            "text": "    }",
            "lineNumber": 157
          },
          {
            "text": "  }",
            "lineNumber": 158
          },
          {
            "text": "});",
            "lineNumber": 159
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 160
          },
          {
            "lineNumber": 161
          },
          {
            "text": "**Key Points:**",
            "lineNumber": 162
          },
          {
            "text": "- **Error handling**: Check &#96;next is AsyncError&#96; and &#96;!next.isRefreshing&#96; to avoid showing errors during refresh",
            "lineNumber": 163
          },
          {
            "text": "- **Success handling**: Check &#96;next is AsyncData &amp;&amp; prev is AsyncLoading&#96; to detect successful completion",
            "lineNumber": 164
          },
          {
            "text": "- **Context safety**: Always check &#96;context.mounted&#96; before navigation or context-dependent operations",
            "lineNumber": 165
          },
          {
            "text": "- **Message extraction**: Use &#96;next.value?.message&#96; for API response messages, or provide fallback strings",
            "lineNumber": 166
          },
          {
            "text": "- **Navigation**: Use &#96;context.pop()&#96; or &#96;goToXxx(ref)&#96; from event mixins after successful operations",
            "lineNumber": 167
          },
          {
            "lineNumber": 168
          },
          {
            "text": "**Additional Examples:**",
            "lineNumber": 169
          },
          {
            "text": "- &#96;help_desk_screen.dart&#96; lines 36‑54: Help desk form submission",
            "lineNumber": 170
          },
          {
            "text": "- &#96;account_screen.dart&#96; lines 36‑54: Logout operation",
            "lineNumber": 171
          }
        ]
      },
      "score": 0.22558146715164185
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/src/monitoring/error_log_client.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 9
          }
        },
        "contents": "import 'package:flutter/foundation.dart';\n\nabstract class ErrorLogClient {\n  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace);\n\n  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails);\n\n  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace);\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "abstract class ErrorLogClient {",
            "lineNumber": 3
          },
          {
            "text": "  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace);",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails);",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace);",
            "lineNumber": 8
          },
          {
            "text": "}",
            "lineNumber": 9
          }
        ]
      },
      "score": 0.22120310366153717
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/initializer.dart",
        "range": {
          "startPosition": {
            "line": 13
          },
          "endPosition": {
            "line": 76
          }
        },
        "contents": "Future&lt;void&gt; initializeApp({{#use_firebase}}{required FirebaseOptions firebaseOptions}{{/use_firebase}}) async {\n  final container = ProviderContainer();\n  \n  {{#use_splash}}\n  final widgetsBinding = WidgetsFlutterBinding.ensureInitialized();\n  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);\n  {{/use_splash}}\n  \n  {{^use_splash}}\n  WidgetsFlutterBinding.ensureInitialized();\n  {{/use_splash}}\n\n  {{#use_firebase}}\n  // Initialize Firebase\n  await Firebase.initializeApp(options: firebaseOptions);\n\n  {{^use_sentry}}\n  // Handle Flutter errors with Crashlytics\n  FlutterError.onError = (errorDetails) {\n    FirebaseCrashlytics.instance.recordFlutterFatalError(errorDetails);\n  };\n\n  // Pass all uncaught asynchronous errors to Crashlytics\n  PlatformDispatcher.instance.onError = (error, stack) {\n    FirebaseCrashlytics.instance.recordError(error, stack, fatal: true);\n    return true;\n  };\n\n  // Enable Crashlytics collection only in release builds\n  await FirebaseCrashlytics.instance.setCrashlyticsCollectionEnabled(\n    kReleaseMode,\n  );\n  {{/use_sentry}}\n\n  {{^use_mixpanel}}\n  // Initialize Firebase Analytics - explicitly enable\n  final analytics = container.read(firebaseAnalyticsClientProvider);\n  await analytics.setAnalyticsCollectionEnabled(true);\n  {{/use_mixpanel}}\n\n  FirebaseMessaging.onBackgroundMessage(firebaseMessagingBackgroundHandler);\n  {{/use_firebase}}\n  \n  {{#use_sentry}}\n  // Initialize Sentry\n  await SentryFlutter.init((options) {\n    options.dsn = F.sentryDsn;\n    options.environment = F.appFlavor.name;\n    options.beforeSend = (SentryEvent event, Hint hint) async {\n      // Ignore events that are not from release builds\n      if (kDebugMode) {\n        return null;\n      }\n      // For all other events, return the event as is\n      return event;\n    };\n  });\n\n  // Handle Flutter errors with Sentry\n  FlutterError.onError = (errorDetails) {\n    Sentry.captureException(\n      errorDetails.exception,",
        "signatures": {},
        "detailedLines": [
          {
            "text": "Future&lt;void&gt; initializeApp({{#use_firebase}}{required FirebaseOptions firebaseOptions}{{/use_firebase}}) async {",
            "lineNumber": 15
          },
          {
            "text": "  final container = ProviderContainer();",
            "lineNumber": 16
          },
          {
            "text": "  ",
            "lineNumber": 17
          },
          {
            "text": "  {{#use_splash}}",
            "lineNumber": 18
          },
          {
            "text": "  final widgetsBinding = WidgetsFlutterBinding.ensureInitialized();",
            "lineNumber": 19
          },
          {
            "text": "  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);",
            "lineNumber": 20
          },
          {
            "text": "  {{/use_splash}}",
            "lineNumber": 21
          },
          {
            "text": "  ",
            "lineNumber": 22
          },
          {
            "text": "  {{^use_splash}}",
            "lineNumber": 23
          },
          {
            "text": "  WidgetsFlutterBinding.ensureInitialized();",
            "lineNumber": 24
          },
          {
            "text": "  {{/use_splash}}",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "  {{#use_firebase}}",
            "lineNumber": 27
          },
          {
            "text": "  // Initialize Firebase",
            "lineNumber": 28
          },
          {
            "text": "  await Firebase.initializeApp(options: firebaseOptions);",
            "lineNumber": 29
          },
          {
            "lineNumber": 30
          },
          {
            "text": "  {{^use_sentry}}",
            "lineNumber": 31
          },
          {
            "text": "  // Handle Flutter errors with Crashlytics",
            "lineNumber": 32
          },
          {
            "text": "  FlutterError.onError = (errorDetails) {",
            "lineNumber": 33
          },
          {
            "text": "    FirebaseCrashlytics.instance.recordFlutterFatalError(errorDetails);",
            "lineNumber": 34
          },
          {
            "text": "  };",
            "lineNumber": 35
          },
          {
            "lineNumber": 36
          },
          {
            "text": "  // Pass all uncaught asynchronous errors to Crashlytics",
            "lineNumber": 37
          },
          {
            "text": "  PlatformDispatcher.instance.onError = (error, stack) {",
            "lineNumber": 38
          },
          {
            "text": "    FirebaseCrashlytics.instance.recordError(error, stack, fatal: true);",
            "lineNumber": 39
          },
          {
            "text": "    return true;",
            "lineNumber": 40
          },
          {
            "text": "  };",
            "lineNumber": 41
          },
          {
            "lineNumber": 42
          },
          {
            "text": "  // Enable Crashlytics collection only in release builds",
            "lineNumber": 43
          },
          {
            "text": "  await FirebaseCrashlytics.instance.setCrashlyticsCollectionEnabled(",
            "lineNumber": 44
          },
          {
            "text": "    kReleaseMode,",
            "lineNumber": 45
          },
          {
            "text": "  );",
            "lineNumber": 46
          },
          {
            "text": "  {{/use_sentry}}",
            "lineNumber": 47
          },
          {
            "lineNumber": 48
          },
          {
            "text": "  {{^use_mixpanel}}",
            "lineNumber": 49
          },
          {
            "text": "  // Initialize Firebase Analytics - explicitly enable",
            "lineNumber": 50
          },
          {
            "text": "  final analytics = container.read(firebaseAnalyticsClientProvider);",
            "lineNumber": 51
          },
          {
            "text": "  await analytics.setAnalyticsCollectionEnabled(true);",
            "lineNumber": 52
          },
          {
            "text": "  {{/use_mixpanel}}",
            "lineNumber": 53
          },
          {
            "lineNumber": 54
          },
          {
            "text": "  FirebaseMessaging.onBackgroundMessage(firebaseMessagingBackgroundHandler);",
            "lineNumber": 55
          },
          {
            "text": "  {{/use_firebase}}",
            "lineNumber": 56
          },
          {
            "text": "  ",
            "lineNumber": 57
          },
          {
            "text": "  {{#use_sentry}}",
            "lineNumber": 58
          },
          {
            "text": "  // Initialize Sentry",
            "lineNumber": 59
          },
          {
            "text": "  await SentryFlutter.init((options) {",
            "lineNumber": 60
          },
          {
            "text": "    options.dsn = F.sentryDsn;",
            "lineNumber": 61
          },
          {
            "text": "    options.environment = F.appFlavor.name;",
            "lineNumber": 62
          },
          {
            "text": "    options.beforeSend = (SentryEvent event, Hint hint) async {",
            "lineNumber": 63
          },
          {
            "text": "      // Ignore events that are not from release builds",
            "lineNumber": 64
          },
          {
            "text": "      if (kDebugMode) {",
            "lineNumber": 65
          },
          {
            "text": "        return null;",
            "lineNumber": 66
          },
          {
            "text": "      }",
            "lineNumber": 67
          },
          {
            "text": "      // For all other events, return the event as is",
            "lineNumber": 68
          },
          {
            "text": "      return event;",
            "lineNumber": 69
          },
          {
            "text": "    };",
            "lineNumber": 70
          },
          {
            "text": "  });",
            "lineNumber": 71
          },
          {
            "lineNumber": 72
          },
          {
            "text": "  // Handle Flutter errors with Sentry",
            "lineNumber": 73
          },
          {
            "text": "  FlutterError.onError = (errorDetails) {",
            "lineNumber": 74
          },
          {
            "text": "    Sentry.captureException(",
            "lineNumber": 75
          },
          {
            "text": "      errorDetails.exception,",
            "lineNumber": 76
          }
        ]
      },
      "score": 0.21654769778251648
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/.cursor/rules/flutter-ui-patterns.mdc",
        "range": {
          "startPosition": {
            "line": 118
          },
          "endPosition": {
            "line": 171
          }
        },
        "contents": "### Rules\n\n1. **&#96;ref.watch()&#96; and &#96;ref.read()&#96;**: Must be encapsulated in state/event mixins\n   - Create methods in &#96;*_state.dart&#96; mixins for &#96;ref.watch()&#96; calls\n   - Create methods in &#96;*_event.dart&#96; mixins for &#96;ref.read()&#96; calls\n   - Call these mixin methods from the UI layer\n\n2. **&#96;ref.listen()&#96;**: Allowed in UI layer for side effects\n   - Use for showing snackbars, navigation callbacks, handling async results, etc.\n   - Must be called in the &#96;build&#96; method, typically at the beginning after getting localization\n\n### Listening to Async Results\n\nWhen listening to controller providers that return &#96;AsyncValue&#96;, use this pattern to handle errors and success states:\n\n**Pattern for Async Operations** (&#96;forgot_password_screen.dart&#96; lines 30‑49):\n&#96;&#96;&#96;dart\nref.listen&lt;AsyncValue&gt;(forgotPasswordControllerProvider, (prev, next) {\n  // Handle error state\n  if (next is AsyncError) {\n    if (!next.isRefreshing &amp;&amp; next.hasError) {\n      CustomSnackbar.show(\n        context,\n        CustomSnackbarMode.error,\n        next.error.toString(),\n      );\n    }\n  }\n  // Handle success state (transition from loading to data)\n  else if (next is AsyncData &amp;&amp; prev is AsyncLoading) {\n    if (context.mounted) {\n      CustomSnackbar.show(\n        context,\n        CustomSnackbarMode.success,\n        next.value?.message ?? '',\n      );\n      context.pop(); // Navigate back on success\n    }\n  }\n});\n&#96;&#96;&#96;\n\n**Key Points:**\n- **Error handling**: Check &#96;next is AsyncError&#96; and &#96;!next.isRefreshing&#96; to avoid showing errors during refresh\n- **Success handling**: Check &#96;next is AsyncData &amp;&amp; prev is AsyncLoading&#96; to detect successful completion\n- **Context safety**: Always check &#96;context.mounted&#96; before navigation or context-dependent operations\n- **Message extraction**: Use &#96;next.value?.message&#96; for API response messages, or provide fallback strings\n- **Navigation**: Use &#96;context.pop()&#96; or &#96;goToXxx(ref)&#96; from event mixins after successful operations\n\n**Additional Examples:**\n- &#96;help_desk_screen.dart&#96; lines 36‑54: Help desk form submission\n- &#96;account_screen.dart&#96; lines 36‑54: Logout operation",
        "signatures": {},
        "detailedLines": [
          {
            "text": "### Rules",
            "lineNumber": 120
          },
          {
            "lineNumber": 121
          },
          {
            "text": "1. **&#96;ref.watch()&#96; and &#96;ref.read()&#96;**: Must be encapsulated in state/event mixins",
            "lineNumber": 122
          },
          {
            "text": "   - Create methods in &#96;*_state.dart&#96; mixins for &#96;ref.watch()&#96; calls",
            "lineNumber": 123
          },
          {
            "text": "   - Create methods in &#96;*_event.dart&#96; mixins for &#96;ref.read()&#96; calls",
            "lineNumber": 124
          },
          {
            "text": "   - Call these mixin methods from the UI layer",
            "lineNumber": 125
          },
          {
            "lineNumber": 126
          },
          {
            "text": "2. **&#96;ref.listen()&#96;**: Allowed in UI layer for side effects",
            "lineNumber": 127
          },
          {
            "text": "   - Use for showing snackbars, navigation callbacks, handling async results, etc.",
            "lineNumber": 128
          },
          {
            "text": "   - Must be called in the &#96;build&#96; method, typically at the beginning after getting localization",
            "lineNumber": 129
          },
          {
            "lineNumber": 130
          },
          {
            "text": "### Listening to Async Results",
            "lineNumber": 131
          },
          {
            "lineNumber": 132
          },
          {
            "text": "When listening to controller providers that return &#96;AsyncValue&#96;, use this pattern to handle errors and success states:",
            "lineNumber": 133
          },
          {
            "lineNumber": 134
          },
          {
            "text": "**Pattern for Async Operations** (&#96;forgot_password_screen.dart&#96; lines 30‑49):",
            "lineNumber": 135
          },
          {
            "text": "&#96;&#96;&#96;dart",
            "lineNumber": 136
          },
          {
            "text": "ref.listen&lt;AsyncValue&gt;(forgotPasswordControllerProvider, (prev, next) {",
            "lineNumber": 137
          },
          {
            "text": "  // Handle error state",
            "lineNumber": 138
          },
          {
            "text": "  if (next is AsyncError) {",
            "lineNumber": 139
          },
          {
            "text": "    if (!next.isRefreshing &amp;&amp; next.hasError) {",
            "lineNumber": 140
          },
          {
            "text": "      CustomSnackbar.show(",
            "lineNumber": 141
          },
          {
            "text": "        context,",
            "lineNumber": 142
          },
          {
            "text": "        CustomSnackbarMode.error,",
            "lineNumber": 143
          },
          {
            "text": "        next.error.toString(),",
            "lineNumber": 144
          },
          {
            "text": "      );",
            "lineNumber": 145
          },
          {
            "text": "    }",
            "lineNumber": 146
          },
          {
            "text": "  }",
            "lineNumber": 147
          },
          {
            "text": "  // Handle success state (transition from loading to data)",
            "lineNumber": 148
          },
          {
            "text": "  else if (next is AsyncData &amp;&amp; prev is AsyncLoading) {",
            "lineNumber": 149
          },
          {
            "text": "    if (context.mounted) {",
            "lineNumber": 150
          },
          {
            "text": "      CustomSnackbar.show(",
            "lineNumber": 151
          },
          {
            "text": "        context,",
            "lineNumber": 152
          },
          {
            "text": "        CustomSnackbarMode.success,",
            "lineNumber": 153
          },
          {
            "text": "        next.value?.message ?? '',",
            "lineNumber": 154
          },
          {
            "text": "      );",
            "lineNumber": 155
          },
          {
            "text": "      context.pop(); // Navigate back on success",
            "lineNumber": 156
          },
          {
            "text": "    }",
            "lineNumber": 157
          },
          {
            "text": "  }",
            "lineNumber": 158
          },
          {
            "text": "});",
            "lineNumber": 159
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 160
          },
          {
            "lineNumber": 161
          },
          {
            "text": "**Key Points:**",
            "lineNumber": 162
          },
          {
            "text": "- **Error handling**: Check &#96;next is AsyncError&#96; and &#96;!next.isRefreshing&#96; to avoid showing errors during refresh",
            "lineNumber": 163
          },
          {
            "text": "- **Success handling**: Check &#96;next is AsyncData &amp;&amp; prev is AsyncLoading&#96; to detect successful completion",
            "lineNumber": 164
          },
          {
            "text": "- **Context safety**: Always check &#96;context.mounted&#96; before navigation or context-dependent operations",
            "lineNumber": 165
          },
          {
            "text": "- **Message extraction**: Use &#96;next.value?.message&#96; for API response messages, or provide fallback strings",
            "lineNumber": 166
          },
          {
            "text": "- **Navigation**: Use &#96;context.pop()&#96; or &#96;goToXxx(ref)&#96; from event mixins after successful operations",
            "lineNumber": 167
          },
          {
            "lineNumber": 168
          },
          {
            "text": "**Additional Examples:**",
            "lineNumber": 169
          },
          {
            "text": "- &#96;help_desk_screen.dart&#96; lines 36‑54: Help desk form submission",
            "lineNumber": 170
          },
          {
            "text": "- &#96;account_screen.dart&#96; lines 36‑54: Logout operation",
            "lineNumber": 171
          }
        ]
      },
      "score": 0.21556329727172852
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/src/common_widget/async_value_widget.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 55
          }
        },
        "contents": "import 'package:flutter/foundation.dart';\nimport 'package:flutter/material.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\n\nimport '../../flavor.dart';\nimport '../constant/error_message.dart';\nimport '../utils/common_utils.dart';\n\nclass AsyncValueWidget&lt;T&gt; extends StatelessWidget {\n  const AsyncValueWidget({\n    super.key,\n    required this.value,\n    required this.data,\n    this.customLoading,\n    this.onError,\n    this.skipRefreshLoading = true,\n    this.skipError = false,\n  });\n  final AsyncValue&lt;T&gt; value;\n  final Widget Function(T) data;\n  final Widget? customLoading;\n  final Widget Function(Object, StackTrace)? onError;\n  final bool skipRefreshLoading;\n  final bool skipError;\n\n  @override\n  Widget build(BuildContext context) {\n    return value.when(\n      data: data,\n      skipLoadingOnRefresh: skipRefreshLoading,\n      skipError: skipError,\n      error:\n          onError ??\n          (e, st) {\n            CommonUtils.printAndRecordLog('$e', '$st');\n\n            final isPrd = kReleaseMode || F.appFlavor == Flavor.prod;\n\n            final errorMsg =\n                e != ErrorMessage.noInternetMsg &amp;&amp;\n                    e != ErrorMessage.requestTimeoutMsg\n                ? '$e\\n\\n$st'\n                : '$e';\n\n            return Center(\n              child: Text(\n                isPrd ? ErrorMessage.defaultUnParseErrorMsg : errorMsg,\n              ),\n            );\n          },\n      loading: () =&gt;\n          Center(child: customLoading ?? const CircularProgressIndicator()),\n    );\n  }\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 1
          },
          {
            "text": "import 'package:flutter/material.dart';",
            "lineNumber": 2
          },
          {
            "text": "import 'package:flutter_riverpod/flutter_riverpod.dart';",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "import '../../flavor.dart';",
            "lineNumber": 5
          },
          {
            "text": "import '../constant/error_message.dart';",
            "lineNumber": 6
          },
          {
            "text": "import '../utils/common_utils.dart';",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "class AsyncValueWidget&lt;T&gt; extends StatelessWidget {",
            "lineNumber": 9
          },
          {
            "text": "  const AsyncValueWidget({",
            "lineNumber": 10
          },
          {
            "text": "    super.key,",
            "lineNumber": 11
          },
          {
            "text": "    required this.value,",
            "lineNumber": 12
          },
          {
            "text": "    required this.data,",
            "lineNumber": 13
          },
          {
            "text": "    this.customLoading,",
            "lineNumber": 14
          },
          {
            "text": "    this.onError,",
            "lineNumber": 15
          },
          {
            "text": "    this.skipRefreshLoading = true,",
            "lineNumber": 16
          },
          {
            "text": "    this.skipError = false,",
            "lineNumber": 17
          },
          {
            "text": "  });",
            "lineNumber": 18
          },
          {
            "text": "  final AsyncValue&lt;T&gt; value;",
            "lineNumber": 19
          },
          {
            "text": "  final Widget Function(T) data;",
            "lineNumber": 20
          },
          {
            "text": "  final Widget? customLoading;",
            "lineNumber": 21
          },
          {
            "text": "  final Widget Function(Object, StackTrace)? onError;",
            "lineNumber": 22
          },
          {
            "text": "  final bool skipRefreshLoading;",
            "lineNumber": 23
          },
          {
            "text": "  final bool skipError;",
            "lineNumber": 24
          },
          {
            "lineNumber": 25
          },
          {
            "text": "  @override",
            "lineNumber": 26
          },
          {
            "text": "  Widget build(BuildContext context) {",
            "lineNumber": 27
          },
          {
            "text": "    return value.when(",
            "lineNumber": 28
          },
          {
            "text": "      data: data,",
            "lineNumber": 29
          },
          {
            "text": "      skipLoadingOnRefresh: skipRefreshLoading,",
            "lineNumber": 30
          },
          {
            "text": "      skipError: skipError,",
            "lineNumber": 31
          },
          {
            "text": "      error:",
            "lineNumber": 32
          },
          {
            "text": "          onError ??",
            "lineNumber": 33
          },
          {
            "text": "          (e, st) {",
            "lineNumber": 34
          },
          {
            "text": "            CommonUtils.printAndRecordLog('$e', '$st');",
            "lineNumber": 35
          },
          {
            "lineNumber": 36
          },
          {
            "text": "            final isPrd = kReleaseMode || F.appFlavor == Flavor.prod;",
            "lineNumber": 37
          },
          {
            "lineNumber": 38
          },
          {
            "text": "            final errorMsg =",
            "lineNumber": 39
          },
          {
            "text": "                e != ErrorMessage.noInternetMsg &amp;&amp;",
            "lineNumber": 40
          },
          {
            "text": "                    e != ErrorMessage.requestTimeoutMsg",
            "lineNumber": 41
          },
          {
            "text": "                ? '$e\\n\\n$st'",
            "lineNumber": 42
          },
          {
            "text": "                : '$e';",
            "lineNumber": 43
          },
          {
            "lineNumber": 44
          },
          {
            "text": "            return Center(",
            "lineNumber": 45
          },
          {
            "text": "              child: Text(",
            "lineNumber": 46
          },
          {
            "text": "                isPrd ? ErrorMessage.defaultUnParseErrorMsg : errorMsg,",
            "lineNumber": 47
          },
          {
            "text": "              ),",
            "lineNumber": 48
          },
          {
            "text": "            );",
            "lineNumber": 49
          },
          {
            "text": "          },",
            "lineNumber": 50
          },
          {
            "text": "      loading: () =&gt;",
            "lineNumber": 51
          },
          {
            "text": "          Center(child: customLoading ?? const CircularProgressIndicator()),",
            "lineNumber": 52
          },
          {
            "text": "    );",
            "lineNumber": 53
          },
          {
            "text": "  }",
            "lineNumber": 54
          },
          {
            "text": "}",
            "lineNumber": 55
          }
        ]
      },
      "score": 0.20788973569869995
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/.cursor/rules/derived-cursor-rules.mdc",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 40
          }
        },
        "contents": "---\ndescription: AI rules derived by SpecStory from the project AI interaction history\nglobs: *\n---\n\n## PROJECT OVERVIEW\n\nThis file defines the project rules, coding standards, workflow guidelines, references, documentation structure, and best practices for the AI coding assistant. It is a living document that evolves with the project.\n\n## CODE STYLE\n\n*   Follow the Dart style guide.\n*   Use effective comments and documentation.\n*   Ensure consistent naming conventions. Firebase's recommended pattern uses past tense for user actions and prefixes for app lifecycle events.\n\n## FOLDER ORGANIZATION\n\n(No specific rules defined yet)\n\n## TECH STACK\n\n*   Dart\n*   Flutter\n*   Riverpod\n*   Firebase Analytics\n*   Crashlytics\n\n## PROJECT-SPECIFIC STANDARDS\n\n*   When implementing analytics, use the Facade pattern with an &#96;AnalyticsClient&#96; abstraction.\n*   Implementations should include &#96;FirebaseAnalyticsClient&#96; and &#96;LoggerAnalyticsClient&#96; for production and debug logging, respectively.\n*   Riverpod providers should be correctly configured, for example with &#96;keepAlive: true&#96; when appropriate.\n*   When dispatching events to multiple analytics clients, use parallel execution (e.g., &#96;Future.wait(clients.map(work))&#96;) for improved performance.\n*   When adding new analytics methods, adhere to the existing Facade pattern. Update the &#96;AnalyticsClient&#96; interface, &#96;AnalyticsFacade&#96;, and all client implementations (&#96;FirebaseAnalyticsClient&#96;, &#96;LoggerAnalyticsClient&#96;) consistently.\n*   When implementing error logging, use the Facade pattern with an &#96;ErrorLogClient&#96; abstraction. Implementations should include &#96;CrashlyticsErrorLogClient&#96; and &#96;LoggerErrorLogClient&#96; for production and debug logging, respectively. The &#96;CommonUtils.printAndRecordLog()&#96; method should use the &#96;ErrorLogFacade&#96; instead of directly calling Firebase Crashlytics.\n*   When creating an &#96;ErrorLogFacade&#96;, it should dispatch to both Crashlytics (in release mode) and the console logger (in debug mode).\n\n## WORKFLOW &amp; RELEASE RULES\n\n*   When generating Firebase configuration files using &#96;flutterfire config&#96;, ensure that analytics is enabled. If the command doesn't have a direct flag for &#96;IS_ANALYTICS_ENABLED&#96;, add a post-processing step to modify the generated plist files using &#96;plutil&#96; (macOS) or &#96;sed&#96;.",
        "signatures": {},
        "detailedLines": [
          {
            "text": "---",
            "lineNumber": 1
          },
          {
            "text": "description: AI rules derived by SpecStory from the project AI interaction history",
            "lineNumber": 2
          },
          {
            "text": "globs: *",
            "lineNumber": 3
          },
          {
            "text": "---",
            "lineNumber": 4
          },
          {
            "lineNumber": 5
          },
          {
            "text": "## PROJECT OVERVIEW",
            "lineNumber": 6
          },
          {
            "lineNumber": 7
          },
          {
            "text": "This file defines the project rules, coding standards, workflow guidelines, references, documentation structure, and best practices for the AI coding assistant. It is a living document that evolves with the project.",
            "lineNumber": 8
          },
          {
            "lineNumber": 9
          },
          {
            "text": "## CODE STYLE",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "*   Follow the Dart style guide.",
            "lineNumber": 12
          },
          {
            "text": "*   Use effective comments and documentation.",
            "lineNumber": 13
          },
          {
            "text": "*   Ensure consistent naming conventions. Firebase's recommended pattern uses past tense for user actions and prefixes for app lifecycle events.",
            "lineNumber": 14
          },
          {
            "lineNumber": 15
          },
          {
            "text": "## FOLDER ORGANIZATION",
            "lineNumber": 16
          },
          {
            "lineNumber": 17
          },
          {
            "text": "(No specific rules defined yet)",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "text": "## TECH STACK",
            "lineNumber": 20
          },
          {
            "lineNumber": 21
          },
          {
            "text": "*   Dart",
            "lineNumber": 22
          },
          {
            "text": "*   Flutter",
            "lineNumber": 23
          },
          {
            "text": "*   Riverpod",
            "lineNumber": 24
          },
          {
            "text": "*   Firebase Analytics",
            "lineNumber": 25
          },
          {
            "text": "*   Crashlytics",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "## PROJECT-SPECIFIC STANDARDS",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "*   When implementing analytics, use the Facade pattern with an &#96;AnalyticsClient&#96; abstraction.",
            "lineNumber": 30
          },
          {
            "text": "*   Implementations should include &#96;FirebaseAnalyticsClient&#96; and &#96;LoggerAnalyticsClient&#96; for production and debug logging, respectively.",
            "lineNumber": 31
          },
          {
            "text": "*   Riverpod providers should be correctly configured, for example with &#96;keepAlive: true&#96; when appropriate.",
            "lineNumber": 32
          },
          {
            "text": "*   When dispatching events to multiple analytics clients, use parallel execution (e.g., &#96;Future.wait(clients.map(work))&#96;) for improved performance.",
            "lineNumber": 33
          },
          {
            "text": "*   When adding new analytics methods, adhere to the existing Facade pattern. Update the &#96;AnalyticsClient&#96; interface, &#96;AnalyticsFacade&#96;, and all client implementations (&#96;FirebaseAnalyticsClient&#96;, &#96;LoggerAnalyticsClient&#96;) consistently.",
            "lineNumber": 34
          },
          {
            "text": "*   When implementing error logging, use the Facade pattern with an &#96;ErrorLogClient&#96; abstraction. Implementations should include &#96;CrashlyticsErrorLogClient&#96; and &#96;LoggerErrorLogClient&#96; for production and debug logging, respectively. The &#96;CommonUtils.printAndRecordLog()&#96; method should use the &#96;ErrorLogFacade&#96; instead of directly calling Firebase Crashlytics.",
            "lineNumber": 35
          },
          {
            "text": "*   When creating an &#96;ErrorLogFacade&#96;, it should dispatch to both Crashlytics (in release mode) and the console logger (in debug mode).",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "## WORKFLOW &amp; RELEASE RULES",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "*   When generating Firebase configuration files using &#96;flutterfire config&#96;, ensure that analytics is enabled. If the command doesn't have a direct flag for &#96;IS_ANALYTICS_ENABLED&#96;, add a post-processing step to modify the generated plist files using &#96;plutil&#96; (macOS) or &#96;sed&#96;.",
            "lineNumber": 40
          }
        ]
      },
      "score": 0.19222813844680786
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/src/service/firebase/crashlytics/firebase_crashlytics_client.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 43
          }
        },
        "contents": "import 'dart:async';\n\nimport 'package:firebase_crashlytics/firebase_crashlytics.dart';\nimport 'package:flutter/foundation.dart';\nimport 'package:riverpod_annotation/riverpod_annotation.dart';\n\nimport '../../../monitoring/error_log_client.dart';\n\npart 'firebase_crashlytics_client.g.dart';\n\nclass FirebaseCrashlyticsClient implements ErrorLogClient {\n  const FirebaseCrashlyticsClient(this._crashlytics);\n  final FirebaseCrashlytics _crashlytics;\n\n  Future&lt;void&gt; init() async {\n    await _crashlytics.setCrashlyticsCollectionEnabled(kDebugMode);\n  }\n\n  @override\n  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace) async {\n    await _crashlytics.recordError(\n      error,\n      stackTrace,\n      fatal: true,\n      printDetails: false,\n    );\n  }\n\n  @override\n  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails) async {\n    await _crashlytics.recordFlutterError(errorDetails);\n  }\n\n  @override\n  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace) async {\n    await _crashlytics.recordError(error, stackTrace, printDetails: false);\n  }\n}\n\n@Riverpod(keepAlive: true)\nFirebaseCrashlyticsClient firebaseCrashlyticsClient(Ref ref) {\n  return FirebaseCrashlyticsClient(FirebaseCrashlytics.instance);\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:async';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "import 'package:firebase_crashlytics/firebase_crashlytics.dart';",
            "lineNumber": 3
          },
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 4
          },
          {
            "text": "import 'package:riverpod_annotation/riverpod_annotation.dart';",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "import '../../../monitoring/error_log_client.dart';",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "part 'firebase_crashlytics_client.g.dart';",
            "lineNumber": 9
          },
          {
            "lineNumber": 10
          },
          {
            "text": "class FirebaseCrashlyticsClient implements ErrorLogClient {",
            "lineNumber": 11
          },
          {
            "text": "  const FirebaseCrashlyticsClient(this._crashlytics);",
            "lineNumber": 12
          },
          {
            "text": "  final FirebaseCrashlytics _crashlytics;",
            "lineNumber": 13
          },
          {
            "lineNumber": 14
          },
          {
            "text": "  Future&lt;void&gt; init() async {",
            "lineNumber": 15
          },
          {
            "text": "    await _crashlytics.setCrashlyticsCollectionEnabled(kDebugMode);",
            "lineNumber": 16
          },
          {
            "text": "  }",
            "lineNumber": 17
          },
          {
            "lineNumber": 18
          },
          {
            "text": "  @override",
            "lineNumber": 19
          },
          {
            "text": "  Future&lt;void&gt; fatalError(dynamic error, StackTrace stackTrace) async {",
            "lineNumber": 20
          },
          {
            "text": "    await _crashlytics.recordError(",
            "lineNumber": 21
          },
          {
            "text": "      error,",
            "lineNumber": 22
          },
          {
            "text": "      stackTrace,",
            "lineNumber": 23
          },
          {
            "text": "      fatal: true,",
            "lineNumber": 24
          },
          {
            "text": "      printDetails: false,",
            "lineNumber": 25
          },
          {
            "text": "    );",
            "lineNumber": 26
          },
          {
            "text": "  }",
            "lineNumber": 27
          },
          {
            "lineNumber": 28
          },
          {
            "text": "  @override",
            "lineNumber": 29
          },
          {
            "text": "  Future&lt;void&gt; flutterError(FlutterErrorDetails errorDetails) async {",
            "lineNumber": 30
          },
          {
            "text": "    await _crashlytics.recordFlutterError(errorDetails);",
            "lineNumber": 31
          },
          {
            "text": "  }",
            "lineNumber": 32
          },
          {
            "lineNumber": 33
          },
          {
            "text": "  @override",
            "lineNumber": 34
          },
          {
            "text": "  Future&lt;void&gt; nonFatalError(dynamic error, StackTrace stackTrace) async {",
            "lineNumber": 35
          },
          {
            "text": "    await _crashlytics.recordError(error, stackTrace, printDetails: false);",
            "lineNumber": 36
          },
          {
            "text": "  }",
            "lineNumber": 37
          },
          {
            "text": "}",
            "lineNumber": 38
          },
          {
            "lineNumber": 39
          },
          {
            "text": "@Riverpod(keepAlive: true)",
            "lineNumber": 40
          },
          {
            "text": "FirebaseCrashlyticsClient firebaseCrashlyticsClient(Ref ref) {",
            "lineNumber": 41
          },
          {
            "text": "  return FirebaseCrashlyticsClient(FirebaseCrashlytics.instance);",
            "lineNumber": 42
          },
          {
            "text": "}",
            "lineNumber": 43
          }
        ]
      },
      "score": 0.18998974561691284
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./scripts/sync-template_colors.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 48
          }
        },
        "contents": "import 'dart:io';\n\n/// ANSI color codes for terminal output\nclass ConsoleColors {\n  // Reset\n  static const String reset = '\\x1B[0m';\n  \n  // Colors\n  static const String green = '\\x1B[32m';\n  static const String yellow = '\\x1B[33m';\n  static const String cyan = '\\x1B[36m';\n  static const String red = '\\x1B[31m';\n  static const String brightCyan = '\\x1B[96m';\n  static const String magenta = '\\x1B[35m';\n  \n  /// Check if colors should be enabled\n  static bool get shouldUseColors {\n    try {\n      return stdout.hasTerminal;\n    } catch (e) {\n      return false;\n    }\n  }\n  \n  /// Apply color to text\n  static String colorize(String text, String color) {\n    if (!shouldUseColors) return text;\n    return '$color$text$reset';\n  }\n  \n  /// Color for Mason condition indicator (red for visibility in lists)\n  static String mason(String text) =&gt; colorize(text, red);\n  \n  /// Color for files that are synced/updated\n  static String syncedFile(String text) =&gt; colorize(text, green);\n  \n  /// Color for success messages\n  static String success(String text) =&gt; colorize(text, green);\n  \n  /// Color for dry run messages\n  static String dryRun(String text) =&gt; colorize(text, magenta);\n  \n  /// Color for info messages\n  static String info(String text) =&gt; colorize(text, cyan);\n  \n  /// Color for warnings\n  static String warning(String text) =&gt; colorize(text, yellow);\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'dart:io';",
            "lineNumber": 1
          },
          {
            "lineNumber": 2
          },
          {
            "text": "/// ANSI color codes for terminal output",
            "lineNumber": 3
          },
          {
            "text": "class ConsoleColors {",
            "lineNumber": 4
          },
          {
            "text": "  // Reset",
            "lineNumber": 5
          },
          {
            "text": "  static const String reset = '\\x1B[0m';",
            "lineNumber": 6
          },
          {
            "text": "  ",
            "lineNumber": 7
          },
          {
            "text": "  // Colors",
            "lineNumber": 8
          },
          {
            "text": "  static const String green = '\\x1B[32m';",
            "lineNumber": 9
          },
          {
            "text": "  static const String yellow = '\\x1B[33m';",
            "lineNumber": 10
          },
          {
            "text": "  static const String cyan = '\\x1B[36m';",
            "lineNumber": 11
          },
          {
            "text": "  static const String red = '\\x1B[31m';",
            "lineNumber": 12
          },
          {
            "text": "  static const String brightCyan = '\\x1B[96m';",
            "lineNumber": 13
          },
          {
            "text": "  static const String magenta = '\\x1B[35m';",
            "lineNumber": 14
          },
          {
            "text": "  ",
            "lineNumber": 15
          },
          {
            "text": "  /// Check if colors should be enabled",
            "lineNumber": 16
          },
          {
            "text": "  static bool get shouldUseColors {",
            "lineNumber": 17
          },
          {
            "text": "    try {",
            "lineNumber": 18
          },
          {
            "text": "      return stdout.hasTerminal;",
            "lineNumber": 19
          },
          {
            "text": "    } catch (e) {",
            "lineNumber": 20
          },
          {
            "text": "      return false;",
            "lineNumber": 21
          },
          {
            "text": "    }",
            "lineNumber": 22
          },
          {
            "text": "  }",
            "lineNumber": 23
          },
          {
            "text": "  ",
            "lineNumber": 24
          },
          {
            "text": "  /// Apply color to text",
            "lineNumber": 25
          },
          {
            "text": "  static String colorize(String text, String color) {",
            "lineNumber": 26
          },
          {
            "text": "    if (!shouldUseColors) return text;",
            "lineNumber": 27
          },
          {
            "text": "    return '$color$text$reset';",
            "lineNumber": 28
          },
          {
            "text": "  }",
            "lineNumber": 29
          },
          {
            "text": "  ",
            "lineNumber": 30
          },
          {
            "text": "  /// Color for Mason condition indicator (red for visibility in lists)",
            "lineNumber": 31
          },
          {
            "text": "  static String mason(String text) =&gt; colorize(text, red);",
            "lineNumber": 32
          },
          {
            "text": "  ",
            "lineNumber": 33
          },
          {
            "text": "  /// Color for files that are synced/updated",
            "lineNumber": 34
          },
          {
            "text": "  static String syncedFile(String text) =&gt; colorize(text, green);",
            "lineNumber": 35
          },
          {
            "text": "  ",
            "lineNumber": 36
          },
          {
            "text": "  /// Color for success messages",
            "lineNumber": 37
          },
          {
            "text": "  static String success(String text) =&gt; colorize(text, green);",
            "lineNumber": 38
          },
          {
            "text": "  ",
            "lineNumber": 39
          },
          {
            "text": "  /// Color for dry run messages",
            "lineNumber": 40
          },
          {
            "text": "  static String dryRun(String text) =&gt; colorize(text, magenta);",
            "lineNumber": 41
          },
          {
            "text": "  ",
            "lineNumber": 42
          },
          {
            "text": "  /// Color for info messages",
            "lineNumber": 43
          },
          {
            "text": "  static String info(String text) =&gt; colorize(text, cyan);",
            "lineNumber": 44
          },
          {
            "text": "  ",
            "lineNumber": 45
          },
          {
            "text": "  /// Color for warnings",
            "lineNumber": 46
          },
          {
            "text": "  static String warning(String text) =&gt; colorize(text, yellow);",
            "lineNumber": 47
          },
          {
            "text": "}",
            "lineNumber": 48
          }
        ]
      },
      "score": 0.18958689272403717
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/lib/initializer.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 50
          }
        },
        "contents": "import 'package:firebase_core/firebase_core.dart';\nimport 'package:firebase_messaging/firebase_messaging.dart';\nimport 'package:flutter/foundation.dart';\n\nimport 'package:flutter/material.dart';\nimport 'package:flutter_native_splash/flutter_native_splash.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\n\nimport 'src/routing/app_startup.dart';\nimport 'src/service/firebase/analytics/firebase_analytics_client.dart';\nimport 'src/service/firebase/crashlytics/firebase_crashlytics_client.dart';\nimport 'src/service/firebase/firebase_service.dart';\n\nFuture&lt;void&gt; initializeApp({required FirebaseOptions firebaseOptions}) async {\n  final container = ProviderContainer();\n\n  final widgetsBinding = WidgetsFlutterBinding.ensureInitialized();\n  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);\n\n  // Initialize Firebase\n  await Firebase.initializeApp(options: firebaseOptions);\n\n  // Enable Crashlytics collection only in release builds\n  final crashlytics = container.read(firebaseCrashlyticsClientProvider);\n  await crashlytics.init();\n\n  // Handle Flutter errors with Crashlytics\n  FlutterError.onError = (errorDetails) {\n    crashlytics.flutterError(errorDetails);\n  };\n\n  // Pass all uncaught asynchronous errors to Crashlytics\n  PlatformDispatcher.instance.onError = (error, stack) {\n    crashlytics.nonFatalError(error, stack);\n    return true;\n  };\n\n  // Initialize Firebase Analytics - explicitly enable\n  final analytics = container.read(firebaseAnalyticsClientProvider);\n  await analytics.setAnalyticsCollectionEnabled(true);\n\n  FirebaseMessaging.onBackgroundMessage(firebaseMessagingBackgroundHandler);\n\n  runApp(\n    UncontrolledProviderScope(\n      container: container,\n      child: const AppStartupScreen(),\n    ),\n  );\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:firebase_core/firebase_core.dart';",
            "lineNumber": 1
          },
          {
            "text": "import 'package:firebase_messaging/firebase_messaging.dart';",
            "lineNumber": 2
          },
          {
            "text": "import 'package:flutter/foundation.dart';",
            "lineNumber": 3
          },
          {
            "lineNumber": 4
          },
          {
            "text": "import 'package:flutter/material.dart';",
            "lineNumber": 5
          },
          {
            "text": "import 'package:flutter_native_splash/flutter_native_splash.dart';",
            "lineNumber": 6
          },
          {
            "text": "import 'package:flutter_riverpod/flutter_riverpod.dart';",
            "lineNumber": 7
          },
          {
            "lineNumber": 8
          },
          {
            "text": "import 'src/routing/app_startup.dart';",
            "lineNumber": 9
          },
          {
            "text": "import 'src/service/firebase/analytics/firebase_analytics_client.dart';",
            "lineNumber": 10
          },
          {
            "text": "import 'src/service/firebase/crashlytics/firebase_crashlytics_client.dart';",
            "lineNumber": 11
          },
          {
            "text": "import 'src/service/firebase/firebase_service.dart';",
            "lineNumber": 12
          },
          {
            "lineNumber": 13
          },
          {
            "text": "Future&lt;void&gt; initializeApp({required FirebaseOptions firebaseOptions}) async {",
            "lineNumber": 14
          },
          {
            "text": "  final container = ProviderContainer();",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "  final widgetsBinding = WidgetsFlutterBinding.ensureInitialized();",
            "lineNumber": 17
          },
          {
            "text": "  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);",
            "lineNumber": 18
          },
          {
            "lineNumber": 19
          },
          {
            "text": "  // Initialize Firebase",
            "lineNumber": 20
          },
          {
            "text": "  await Firebase.initializeApp(options: firebaseOptions);",
            "lineNumber": 21
          },
          {
            "lineNumber": 22
          },
          {
            "text": "  // Enable Crashlytics collection only in release builds",
            "lineNumber": 23
          },
          {
            "text": "  final crashlytics = container.read(firebaseCrashlyticsClientProvider);",
            "lineNumber": 24
          },
          {
            "text": "  await crashlytics.init();",
            "lineNumber": 25
          },
          {
            "lineNumber": 26
          },
          {
            "text": "  // Handle Flutter errors with Crashlytics",
            "lineNumber": 27
          },
          {
            "text": "  FlutterError.onError = (errorDetails) {",
            "lineNumber": 28
          },
          {
            "text": "    crashlytics.flutterError(errorDetails);",
            "lineNumber": 29
          },
          {
            "text": "  };",
            "lineNumber": 30
          },
          {
            "lineNumber": 31
          },
          {
            "text": "  // Pass all uncaught asynchronous errors to Crashlytics",
            "lineNumber": 32
          },
          {
            "text": "  PlatformDispatcher.instance.onError = (error, stack) {",
            "lineNumber": 33
          },
          {
            "text": "    crashlytics.nonFatalError(error, stack);",
            "lineNumber": 34
          },
          {
            "text": "    return true;",
            "lineNumber": 35
          },
          {
            "text": "  };",
            "lineNumber": 36
          },
          {
            "lineNumber": 37
          },
          {
            "text": "  // Initialize Firebase Analytics - explicitly enable",
            "lineNumber": 38
          },
          {
            "text": "  final analytics = container.read(firebaseAnalyticsClientProvider);",
            "lineNumber": 39
          },
          {
            "text": "  await analytics.setAnalyticsCollectionEnabled(true);",
            "lineNumber": 40
          },
          {
            "lineNumber": 41
          },
          {
            "text": "  FirebaseMessaging.onBackgroundMessage(firebaseMessagingBackgroundHandler);",
            "lineNumber": 42
          },
          {
            "lineNumber": 43
          },
          {
            "text": "  runApp(",
            "lineNumber": 44
          },
          {
            "text": "    UncontrolledProviderScope(",
            "lineNumber": 45
          },
          {
            "text": "      container: container,",
            "lineNumber": 46
          },
          {
            "text": "      child: const AppStartupScreen(),",
            "lineNumber": 47
          },
          {
            "text": "    ),",
            "lineNumber": 48
          },
          {
            "text": "  );",
            "lineNumber": 49
          },
          {
            "text": "}",
            "lineNumber": 50
          }
        ]
      },
      "score": 0.18902839720249176
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/hooks/pre_gen.dart",
        "range": {
          "startPosition": {
            "line": 49
          },
          "endPosition": {
            "line": 89
          }
        },
        "contents": "  if (customIcon) {\n    String? iconPath = context.vars['app_icon_path'] as String?;\n    // Prompt for custom app icon path\n    if (iconPath == null || iconPath.isEmpty) {\n      // Only prompt if not already provided\n      iconPath = context.logger.prompt(\n        'Enter path to your custom app icon (or press Enter to skip)',\n        defaultValue: '',\n      );\n    }\n    context.vars['app_icon_path'] = iconPath;\n  }\n\n  // Check if use_splash is true\n  final useSplash = context.vars['use_splash'] as bool? ?? false;\n  if (useSplash) {\n    String? splashPath = context.vars['app_splash_path'] as String?;\n    // Prompt for app splash path\n    if (splashPath == null || splashPath.isEmpty) {\n      // Only prompt if not already provided\n      splashPath = context.logger.prompt(\n        'Enter path to your app splash (or press Enter to skip)',\n        defaultValue: '',\n      );\n    }\n    context.vars['app_splash_path'] = splashPath;\n  }\n\n  // Validate firebase_project_id if use_firebase is true\n  if (useFirebase) {\n    final firebaseProjectId = context.vars['firebase_project_id'] as String?;\n    if (firebaseProjectId == null || firebaseProjectId.trim().isEmpty) {\n      throw MasonException(\n        'Firebase Project ID is required when using firebase',\n      );\n    }\n  }\n\n  progress.complete();\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "  if (customIcon) {",
            "lineNumber": 50
          },
          {
            "text": "    String? iconPath = context.vars['app_icon_path'] as String?;",
            "lineNumber": 51
          },
          {
            "text": "    // Prompt for custom app icon path",
            "lineNumber": 52
          },
          {
            "text": "    if (iconPath == null || iconPath.isEmpty) {",
            "lineNumber": 53
          },
          {
            "text": "      // Only prompt if not already provided",
            "lineNumber": 54
          },
          {
            "text": "      iconPath = context.logger.prompt(",
            "lineNumber": 55
          },
          {
            "text": "        'Enter path to your custom app icon (or press Enter to skip)',",
            "lineNumber": 56
          },
          {
            "text": "        defaultValue: '',",
            "lineNumber": 57
          },
          {
            "text": "      );",
            "lineNumber": 58
          },
          {
            "text": "    }",
            "lineNumber": 59
          },
          {
            "text": "    context.vars['app_icon_path'] = iconPath;",
            "lineNumber": 60
          },
          {
            "text": "  }",
            "lineNumber": 61
          },
          {
            "lineNumber": 62
          },
          {
            "text": "  // Check if use_splash is true",
            "lineNumber": 63
          },
          {
            "text": "  final useSplash = context.vars['use_splash'] as bool? ?? false;",
            "lineNumber": 64
          },
          {
            "text": "  if (useSplash) {",
            "lineNumber": 65
          },
          {
            "text": "    String? splashPath = context.vars['app_splash_path'] as String?;",
            "lineNumber": 66
          },
          {
            "text": "    // Prompt for app splash path",
            "lineNumber": 67
          },
          {
            "text": "    if (splashPath == null || splashPath.isEmpty) {",
            "lineNumber": 68
          },
          {
            "text": "      // Only prompt if not already provided",
            "lineNumber": 69
          },
          {
            "text": "      splashPath = context.logger.prompt(",
            "lineNumber": 70
          },
          {
            "text": "        'Enter path to your app splash (or press Enter to skip)',",
            "lineNumber": 71
          },
          {
            "text": "        defaultValue: '',",
            "lineNumber": 72
          },
          {
            "text": "      );",
            "lineNumber": 73
          },
          {
            "text": "    }",
            "lineNumber": 74
          },
          {
            "text": "    context.vars['app_splash_path'] = splashPath;",
            "lineNumber": 75
          },
          {
            "text": "  }",
            "lineNumber": 76
          },
          {
            "lineNumber": 77
          },
          {
            "text": "  // Validate firebase_project_id if use_firebase is true",
            "lineNumber": 78
          },
          {
            "text": "  if (useFirebase) {",
            "lineNumber": 79
          },
          {
            "text": "    final firebaseProjectId = context.vars['firebase_project_id'] as String?;",
            "lineNumber": 80
          },
          {
            "text": "    if (firebaseProjectId == null || firebaseProjectId.trim().isEmpty) {",
            "lineNumber": 81
          },
          {
            "text": "      throw MasonException(",
            "lineNumber": 82
          },
          {
            "text": "        'Firebase Project ID is required when using firebase',",
            "lineNumber": 83
          },
          {
            "text": "      );",
            "lineNumber": 84
          },
          {
            "text": "    }",
            "lineNumber": 85
          },
          {
            "text": "  }",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "  progress.complete();",
            "lineNumber": 88
          },
          {
            "text": "}",
            "lineNumber": 89
          }
        ]
      },
      "score": 0.1781134009361267
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./.cursor/rules/derived-cursor-rules.mdc",
        "range": {
          "startPosition": {
            "line": 669
          },
          "endPosition": {
            "line": 725
          }
        },
        "contents": "|----------|------|---------|             |\n| &#96;project_name&#96; | string | &#96;my_app&#96; | Project name (snake_case) |\n| &#96;app_name&#96; | string | &#96;My App&#96; | Display name on device |\n| &#96;app_id&#96; | string | &#96;com.example.myapp&#96; | Bundle ID |\n| &#96;custom_icon&#96; | boolean | &#96;false&#96; | Use custom app icon |\n| &#96;use_splash&#96; | boolean | &#96;true&#96; | Native splash screen |\n| &#96;use_firebase&#96; | boolean | &#96;true&#96; | Firebase integration |\n| &#96;use_localization&#96; | boolean | &#96;true&#96; | Localization support |\n| &#96;use_dio&#96; | boolean | &#96;true&#96; | Dio HTTP client |\n| &#96;use_sentry&#96; | boolean | &#96;false&#96; | Use Sentry instead of Crashlytics |\n| &#96;use_mixpanel&#96; | boolean | &#96;true&#96; | Mixpanel analytics |\n| &#96;firebase_project_id&#96; | string | &#96;\"\"&#96; | Firebase project ID |\n\n## Testing the Brick Locally\n\nFrom the project root:\n\n&#96;&#96;&#96;bash\nmason make starter --output-dir ./test_output\n&#96;&#96;&#96;\n\n## Git Configuration\n\n- Ensure &#96;@config.json&#96; is included in &#96;.gitignore&#96; to prevent unintentional tracking of local configuration changes.\n\n## Hooks\n\n### &#96;pre_gen.dart&#96;: Obtaining and Validating &#96;firebase_project_id&#96;\n\nThe &#96;firebase_project_id&#96; in &#96;src/hooks/pre_gen.dart&#96; can obtain its value from arguments or &#96;config.json&#96; instead of prompting interactively.\n\nWhen &#96;use_firebase&#96; is true, the code checks if &#96;firebase_project_id&#96; already exists in &#96;context.vars&#96; before prompting. If it exists (from &#96;config.json&#96; or arguments), it uses that value; otherwise, it prompts the user.\n\n**Recommended Implementation:**\n\n&#96;&#96;&#96;dart\nfinal useFirebase = context.vars['use_firebase'] as bool? ?? false;\nif (useFirebase) {\n  // Check if firebase_project_id is already provided\n  var firebaseProjectId = context.vars['firebase_project_id'] as String?;\n  \n  if (firebaseProjectId == null || firebaseProjectId.isEmpty) {\n    // Only prompt if not already provided\n    firebaseProjectId = context.logger.prompt(\n      'Enter your Firebase project ID:',\n      defaultValue: '',\n    );\n  }\n  \n  context.vars['firebase_project_id'] = firebaseProjectId;\n}\n&#96;&#96;&#96;\n\nThis approach ensures that:\n\n- If &#96;config.json&#96; contains &#96;\"firebase_project_id\": \"my-project\"&#96;, it uses that value.",
        "signatures": {},
        "detailedLines": [
          {
            "text": "|----------|------|---------|             |",
            "lineNumber": 670
          },
          {
            "text": "| &#96;project_name&#96; | string | &#96;my_app&#96; | Project name (snake_case) |",
            "lineNumber": 671
          },
          {
            "text": "| &#96;app_name&#96; | string | &#96;My App&#96; | Display name on device |",
            "lineNumber": 672
          },
          {
            "text": "| &#96;app_id&#96; | string | &#96;com.example.myapp&#96; | Bundle ID |",
            "lineNumber": 673
          },
          {
            "text": "| &#96;custom_icon&#96; | boolean | &#96;false&#96; | Use custom app icon |",
            "lineNumber": 674
          },
          {
            "text": "| &#96;use_splash&#96; | boolean | &#96;true&#96; | Native splash screen |",
            "lineNumber": 675
          },
          {
            "text": "| &#96;use_firebase&#96; | boolean | &#96;true&#96; | Firebase integration |",
            "lineNumber": 676
          },
          {
            "text": "| &#96;use_localization&#96; | boolean | &#96;true&#96; | Localization support |",
            "lineNumber": 677
          },
          {
            "text": "| &#96;use_dio&#96; | boolean | &#96;true&#96; | Dio HTTP client |",
            "lineNumber": 678
          },
          {
            "text": "| &#96;use_sentry&#96; | boolean | &#96;false&#96; | Use Sentry instead of Crashlytics |",
            "lineNumber": 679
          },
          {
            "text": "| &#96;use_mixpanel&#96; | boolean | &#96;true&#96; | Mixpanel analytics |",
            "lineNumber": 680
          },
          {
            "text": "| &#96;firebase_project_id&#96; | string | &#96;\"\"&#96; | Firebase project ID |",
            "lineNumber": 681
          },
          {
            "lineNumber": 682
          },
          {
            "text": "## Testing the Brick Locally",
            "lineNumber": 683
          },
          {
            "lineNumber": 684
          },
          {
            "text": "From the project root:",
            "lineNumber": 685
          },
          {
            "lineNumber": 686
          },
          {
            "text": "&#96;&#96;&#96;bash",
            "lineNumber": 687
          },
          {
            "text": "mason make starter --output-dir ./test_output",
            "lineNumber": 688
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 689
          },
          {
            "lineNumber": 690
          },
          {
            "text": "## Git Configuration",
            "lineNumber": 691
          },
          {
            "lineNumber": 692
          },
          {
            "text": "- Ensure &#96;@config.json&#96; is included in &#96;.gitignore&#96; to prevent unintentional tracking of local configuration changes.",
            "lineNumber": 693
          },
          {
            "lineNumber": 694
          },
          {
            "text": "## Hooks",
            "lineNumber": 695
          },
          {
            "lineNumber": 696
          },
          {
            "text": "### &#96;pre_gen.dart&#96;: Obtaining and Validating &#96;firebase_project_id&#96;",
            "lineNumber": 697
          },
          {
            "lineNumber": 698
          },
          {
            "text": "The &#96;firebase_project_id&#96; in &#96;src/hooks/pre_gen.dart&#96; can obtain its value from arguments or &#96;config.json&#96; instead of prompting interactively.",
            "lineNumber": 699
          },
          {
            "lineNumber": 700
          },
          {
            "text": "When &#96;use_firebase&#96; is true, the code checks if &#96;firebase_project_id&#96; already exists in &#96;context.vars&#96; before prompting. If it exists (from &#96;config.json&#96; or arguments), it uses that value; otherwise, it prompts the user.",
            "lineNumber": 701
          },
          {
            "lineNumber": 702
          },
          {
            "text": "**Recommended Implementation:**",
            "lineNumber": 703
          },
          {
            "lineNumber": 704
          },
          {
            "text": "&#96;&#96;&#96;dart",
            "lineNumber": 705
          },
          {
            "text": "final useFirebase = context.vars['use_firebase'] as bool? ?? false;",
            "lineNumber": 706
          },
          {
            "text": "if (useFirebase) {",
            "lineNumber": 707
          },
          {
            "text": "  // Check if firebase_project_id is already provided",
            "lineNumber": 708
          },
          {
            "text": "  var firebaseProjectId = context.vars['firebase_project_id'] as String?;",
            "lineNumber": 709
          },
          {
            "text": "  ",
            "lineNumber": 710
          },
          {
            "text": "  if (firebaseProjectId == null || firebaseProjectId.isEmpty) {",
            "lineNumber": 711
          },
          {
            "text": "    // Only prompt if not already provided",
            "lineNumber": 712
          },
          {
            "text": "    firebaseProjectId = context.logger.prompt(",
            "lineNumber": 713
          },
          {
            "text": "      'Enter your Firebase project ID:',",
            "lineNumber": 714
          },
          {
            "text": "      defaultValue: '',",
            "lineNumber": 715
          },
          {
            "text": "    );",
            "lineNumber": 716
          },
          {
            "text": "  }",
            "lineNumber": 717
          },
          {
            "text": "  ",
            "lineNumber": 718
          },
          {
            "text": "  context.vars['firebase_project_id'] = firebaseProjectId;",
            "lineNumber": 719
          },
          {
            "text": "}",
            "lineNumber": 720
          },
          {
            "text": "&#96;&#96;&#96;",
            "lineNumber": 721
          },
          {
            "lineNumber": 722
          },
          {
            "text": "This approach ensures that:",
            "lineNumber": 723
          },
          {
            "lineNumber": 724
          },
          {
            "text": "- If &#96;config.json&#96; contains &#96;\"firebase_project_id\": \"my-project\"&#96;, it uses that value.",
            "lineNumber": 725
          }
        ]
      },
      "score": 0.16899870336055756
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/src/feature/login/presentation/login_screen.dart",
        "range": {
          "startPosition": {
            "line": 23
          },
          "endPosition": {
            "line": 53
          }
        },
        "contents": "  const LoginScreen({super.key});\n\n  static const String path = 'login';\n\n  static final _formKey = GlobalKey&lt;FormBuilderState&gt;();\n\n  final String keyLoginUsername = 'username';\n  final String keyLoginPassword = 'password';\n\n  @override\n  Widget build(BuildContext context, WidgetRef ref) {\n    ref.listen&lt;AsyncValue&gt;(loginControllerProvider, (prev, next) {\n      if (next is AsyncError) {\n        if (!next.isRefreshing &amp;&amp; next.hasError) {\n          CustomSnackbar.show(\n            context,\n            CustomSnackbarMode.error,\n            next.error.toString(),\n          );\n        }\n      }\n    });\n    {{#use_localization}}\n    final loc = getLocalizations(ref);\n    {{/use_localization}}\n\n    return Scaffold(\n      appBar: AppBar(title: Text({{#use_localization}}loc.login{{/use_localization}}{{^use_localization}}'Login'.hardcoded{{/use_localization}}), centerTitle: true),\n      body: FormBuilder(\n        key: _formKey,",
        "signatures": {},
        "detailedLines": [
          {
            "text": "  const LoginScreen({super.key});",
            "lineNumber": 24
          },
          {
            "lineNumber": 25
          },
          {
            "text": "  static const String path = 'login';",
            "lineNumber": 26
          },
          {
            "lineNumber": 27
          },
          {
            "text": "  static final _formKey = GlobalKey&lt;FormBuilderState&gt;();",
            "lineNumber": 28
          },
          {
            "lineNumber": 29
          },
          {
            "text": "  final String keyLoginUsername = 'username';",
            "lineNumber": 30
          },
          {
            "text": "  final String keyLoginPassword = 'password';",
            "lineNumber": 31
          },
          {
            "lineNumber": 32
          },
          {
            "text": "  @override",
            "lineNumber": 33
          },
          {
            "text": "  Widget build(BuildContext context, WidgetRef ref) {",
            "lineNumber": 34
          },
          {
            "text": "    ref.listen&lt;AsyncValue&gt;(loginControllerProvider, (prev, next) {",
            "lineNumber": 35
          },
          {
            "text": "      if (next is AsyncError) {",
            "lineNumber": 36
          },
          {
            "text": "        if (!next.isRefreshing &amp;&amp; next.hasError) {",
            "lineNumber": 37
          },
          {
            "text": "          CustomSnackbar.show(",
            "lineNumber": 38
          },
          {
            "text": "            context,",
            "lineNumber": 39
          },
          {
            "text": "            CustomSnackbarMode.error,",
            "lineNumber": 40
          },
          {
            "text": "            next.error.toString(),",
            "lineNumber": 41
          },
          {
            "text": "          );",
            "lineNumber": 42
          },
          {
            "text": "        }",
            "lineNumber": 43
          },
          {
            "text": "      }",
            "lineNumber": 44
          },
          {
            "text": "    });",
            "lineNumber": 45
          },
          {
            "text": "    {{#use_localization}}",
            "lineNumber": 46
          },
          {
            "text": "    final loc = getLocalizations(ref);",
            "lineNumber": 47
          },
          {
            "text": "    {{/use_localization}}",
            "lineNumber": 48
          },
          {
            "lineNumber": 49
          },
          {
            "text": "    return Scaffold(",
            "lineNumber": 50
          },
          {
            "text": "      appBar: AppBar(title: Text({{#use_localization}}loc.login{{/use_localization}}{{^use_localization}}'Login'.hardcoded{{/use_localization}}), centerTitle: true),",
            "lineNumber": 51
          },
          {
            "text": "      body: FormBuilder(",
            "lineNumber": 52
          },
          {
            "text": "        key: _formKey,",
            "lineNumber": 53
          }
        ]
      },
      "score": 0.16853976249694824
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/initializer.dart",
        "range": {
          "startPosition": {
            "line": 73
          },
          "endPosition": {
            "line": 102
          }
        },
        "contents": "  FlutterError.onError = (errorDetails) {\n    Sentry.captureException(\n      errorDetails.exception,\n      stackTrace: errorDetails.stack,\n    );\n  };\n\n  // Pass all uncaught asynchronous errors to Sentry\n  PlatformDispatcher.instance.onError = (error, stack) {\n    Sentry.captureException(error, stackTrace: stack);\n    return true;\n  };\n  {{/use_sentry}}\n\n  {{#use_mixpanel}}\n  // * Preload MixpanelAnalyticsClient, so we can make unawaited analytics calls\n  final mixpanelAnalytics = await container.read(\n    mixpanelAnalyticsClientProvider.future,\n  );\n  await mixpanelAnalytics.setAnalyticsCollectionEnabled(true);\n  {{/use_mixpanel}}\n\n  runApp(\n    UncontrolledProviderScope(\n      container: container,\n      child: const AppStartupScreen(),\n    ),\n  );\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "  FlutterError.onError = (errorDetails) {",
            "lineNumber": 74
          },
          {
            "text": "    Sentry.captureException(",
            "lineNumber": 75
          },
          {
            "text": "      errorDetails.exception,",
            "lineNumber": 76
          },
          {
            "text": "      stackTrace: errorDetails.stack,",
            "lineNumber": 77
          },
          {
            "text": "    );",
            "lineNumber": 78
          },
          {
            "text": "  };",
            "lineNumber": 79
          },
          {
            "lineNumber": 80
          },
          {
            "text": "  // Pass all uncaught asynchronous errors to Sentry",
            "lineNumber": 81
          },
          {
            "text": "  PlatformDispatcher.instance.onError = (error, stack) {",
            "lineNumber": 82
          },
          {
            "text": "    Sentry.captureException(error, stackTrace: stack);",
            "lineNumber": 83
          },
          {
            "text": "    return true;",
            "lineNumber": 84
          },
          {
            "text": "  };",
            "lineNumber": 85
          },
          {
            "text": "  {{/use_sentry}}",
            "lineNumber": 86
          },
          {
            "lineNumber": 87
          },
          {
            "text": "  {{#use_mixpanel}}",
            "lineNumber": 88
          },
          {
            "text": "  // * Preload MixpanelAnalyticsClient, so we can make unawaited analytics calls",
            "lineNumber": 89
          },
          {
            "text": "  final mixpanelAnalytics = await container.read(",
            "lineNumber": 90
          },
          {
            "text": "    mixpanelAnalyticsClientProvider.future,",
            "lineNumber": 91
          },
          {
            "text": "  );",
            "lineNumber": 92
          },
          {
            "text": "  await mixpanelAnalytics.setAnalyticsCollectionEnabled(true);",
            "lineNumber": 93
          },
          {
            "text": "  {{/use_mixpanel}}",
            "lineNumber": 94
          },
          {
            "lineNumber": 95
          },
          {
            "text": "  runApp(",
            "lineNumber": 96
          },
          {
            "text": "    UncontrolledProviderScope(",
            "lineNumber": 97
          },
          {
            "text": "      container: container,",
            "lineNumber": 98
          },
          {
            "text": "      child: const AppStartupScreen(),",
            "lineNumber": 99
          },
          {
            "text": "    ),",
            "lineNumber": 100
          },
          {
            "text": "  );",
            "lineNumber": 101
          },
          {
            "text": "}",
            "lineNumber": 102
          }
        ]
      },
      "score": 0.16726279258728027
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./ref/project-starter-ref/.cursor/rules/derived-cursor-rules.mdc",
        "range": {
          "startPosition": {
            "line": 67
          },
          "endPosition": {
            "line": 77,
            "column": 7
          }
        },
        "contents": "*   **DO** dispose of &#96;ProviderContainer&#96; instances created outside of the widget tree. When using &#96;ProviderContainer&#96; in static utility methods like &#96;CommonUtils.printAndRecordLog()&#96;, ensure the container is properly disposed after its work is complete using &#96;.whenComplete()&#96; to prevent memory leaks, especially when asynchronous operations are involved. For example:\n\n    &#96;&#96;&#96;dart\n    final container = ProviderContainer();\n    unawaited(\n      container\n        .read(errorLogFacadeProvider)\n        .nonFatalError(error, StackTrace.fromString(stackTrace))\n        .whenComplete(() =&gt; container.dispose()),\n    );\n    &#96;&#96;&#96;",
        "signatures": {},
        "detailedLines": [
          {
            "text": "*   **DO** dispose of &#96;ProviderContainer&#96; instances created outside of the widget tree. When using &#96;ProviderContainer&#96; in static utility methods like &#96;CommonUtils.printAndRecordLog()&#96;, ensure the container is properly disposed after its work is complete using &#96;.whenComplete()&#96; to prevent memory leaks, especially when asynchronous operations are involved. For example:",
            "lineNumber": 68
          },
          {
            "lineNumber": 69
          },
          {
            "text": "    &#96;&#96;&#96;dart",
            "lineNumber": 70
          },
          {
            "text": "    final container = ProviderContainer();",
            "lineNumber": 71
          },
          {
            "text": "    unawaited(",
            "lineNumber": 72
          },
          {
            "text": "      container",
            "lineNumber": 73
          },
          {
            "text": "        .read(errorLogFacadeProvider)",
            "lineNumber": 74
          },
          {
            "text": "        .nonFatalError(error, StackTrace.fromString(stackTrace))",
            "lineNumber": 75
          },
          {
            "text": "        .whenComplete(() =&gt; container.dispose()),",
            "lineNumber": 76
          },
          {
            "text": "    );",
            "lineNumber": 77
          },
          {
            "text": "    &#96;&#96;&#96;",
            "lineNumber": 78
          }
        ]
      },
      "score": 0.16465729475021362
    },
    {
      "codeBlock": {
        "relativeWorkspacePath": "./src/__brick__/{{project_name}}/lib/src/monitoring/logger_navigator_observer.dart",
        "range": {
          "startPosition": {},
          "endPosition": {
            "line": 31
          }
        },
        "contents": "import 'package:flutter/material.dart';\nimport 'dart:developer';\n\nclass LoggerNavigatorObserver extends NavigatorObserver {\n  static const _name = 'Navigation';\n\n  @override\n  void didPush(Route&lt;dynamic&gt; route, Route&lt;dynamic&gt;? previousRoute) {\n    _logNavigation(route.settings.name, 'push');\n  }\n\n  @override\n  void didPop(Route&lt;dynamic&gt; route, Route&lt;dynamic&gt;? previousRoute) {\n    _logNavigation(route.settings.name, 'pop');\n  }\n\n  @override\n  void didReplace({Route&lt;dynamic&gt;? newRoute, Route&lt;dynamic&gt;? oldRoute}) {\n    if (newRoute != null) {\n      _logNavigation(newRoute.settings.name, 'replace');\n    }\n  }\n\n  void _logNavigation(String? routeName, String action) {\n    if (routeName != null) {\n      log(\"Screen $action: $routeName\", name: _name);\n    } else {\n      log('Route name is missing', name: _name);\n    }\n  }\n}",
        "signatures": {},
        "detailedLines": [
          {
            "text": "import 'package:flutter/material.dart';",
            "lineNumber": 1
          },
          {
            "text": "import 'dart:developer';",
            "lineNumber": 2
          },
          {
            "lineNumber": 3
          },
          {
            "text": "class LoggerNavigatorObserver extends NavigatorObserver {",
            "lineNumber": 4
          },
          {
            "text": "  static const _name = 'Navigation';",
            "lineNumber": 5
          },
          {
            "lineNumber": 6
          },
          {
            "text": "  @override",
            "lineNumber": 7
          },
          {
            "text": "  void didPush(Route&lt;dynamic&gt; route, Route&lt;dynamic&gt;? previousRoute) {",
            "lineNumber": 8
          },
          {
            "text": "    _logNavigation(route.settings.name, 'push');",
            "lineNumber": 9
          },
          {
            "text": "  }",
            "lineNumber": 10
          },
          {
            "lineNumber": 11
          },
          {
            "text": "  @override",
            "lineNumber": 12
          },
          {
            "text": "  void didPop(Route&lt;dynamic&gt; route, Route&lt;dynamic&gt;? previousRoute) {",
            "lineNumber": 13
          },
          {
            "text": "    _logNavigation(route.settings.name, 'pop');",
            "lineNumber": 14
          },
          {
            "text": "  }",
            "lineNumber": 15
          },
          {
            "lineNumber": 16
          },
          {
            "text": "  @override",
            "lineNumber": 17
          },
          {
            "text": "  void didReplace({Route&lt;dynamic&gt;? newRoute, Route&lt;dynamic&gt;? oldRoute}) {",
            "lineNumber": 18
          },
          {
            "text": "    if (newRoute != null) {",
            "lineNumber": 19
          },
          {
            "text": "      _logNavigation(newRoute.settings.name, 'replace');",
            "lineNumber": 20
          },
          {
            "text": "    }",
            "lineNumber": 21
          },
          {
            "text": "  }",
            "lineNumber": 22
          },
          {
            "lineNumber": 23
          },
          {
            "text": "  void _logNavigation(String? routeName, String action) {",
            "lineNumber": 24
          },
          {
            "text": "    if (routeName != null) {",
            "lineNumber": 25
          },
          {
            "text": "      log(\"Screen $action: $routeName\", name: _name);",
            "lineNumber": 26
          },
          {
            "text": "    } else {",
            "lineNumber": 27
          },
          {
            "text": "      log('Route name is missing', name: _name);",
            "lineNumber": 28
          },
          {
            "text": "    }",
            "lineNumber": 29
          },
          {
            "text": "  }",
            "lineNumber": 30
          },
          {
            "text": "}",
            "lineNumber": 31
          }
        ]
      },
      "score": 0.16422690451145172
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="ripgrep_raw_search">
<details>
<summary>Tool use: **ripgrep_raw_search**</summary>


Parameters:

```json
{
  "pattern": "context\\.logger\\.",
  "path": "src/hooks",
  "caseInsensitive": false
}
```
Result:

```json
{
  "success": {
    "pattern": "context\\.logger\\.",
    "path": "src/hooks",
    "outputMode": "content",
    "workspaceResults": {
      "/Users/cirimin/Logique/Project Starter/project-starter": {
        "content": {
          "matches": [
            {
              "file": "src/hooks/pre_gen.dart",
              "matches": [
                {
                  "lineNumber": 4,
                  "content": "  final progress = context.logger.progress('Prepare project');"
                },
                {
                  "lineNumber": 12,
                  "content": "      firebaseProjectId = context.logger.prompt("
                },
                {
                  "lineNumber": 26,
                  "content": "      sentryDsn = context.logger.prompt("
                },
                {
                  "lineNumber": 40,
                  "content": "      mixpanelToken = context.logger.prompt("
                },
                {
                  "lineNumber": 55,
                  "content": "      iconPath = context.logger.prompt("
                },
                {
                  "lineNumber": 70,
                  "content": "      splashPath = context.logger.prompt("
                }
              ]
            },
            {
              "file": "src/hooks/post_gen.dart",
              "matches": [
                {
                  "lineNumber": 122,
                  "content": "    context.logger.warn('project_name not found in context');"
                },
                {
                  "lineNumber": 131,
                  "content": "    context.logger.warn('Xcode project file not found at $pbxprojPath');"
                },
                {
                  "lineNumber": 134,
                  "content": "    context.logger.info('Xcode project file found at $pbxprojPath');"
                },
                {
                  "lineNumber": 164,
                  "content": "    context.logger.info('FlutterFire build phases are in correct order');"
                },
                {
                  "lineNumber": 172,
                  "content": "    context.logger.info("
                }
              ]
            },
            {
              "file": "src/hooks/helper.dart",
              "matches": [
                {
                  "lineNumber": 16,
                  "content": "    final process = context.logger.progress('Running $command $arguments');"
                },
                {
                  "lineNumber": 27,
                  "content": "      context.logger.err('Error: ${result.stderr}');"
                },
                {
                  "lineNumber": 41,
                  "content": "      context.logger.err('Source file not found at: $sourcePath');"
                },
                {
                  "lineNumber": 53,
                  "content": "      context.logger.err("
                },
                {
                  "lineNumber": 61,
                  "content": "      context.logger.success('Applied $originalFileName from: $sourcePath');"
                },
                {
                  "lineNumber": 63,
                  "content": "      context.logger.err('Failed to copy $originalFileName: $e');"
                },
                {
                  "lineNumber": 110,
                  "content": "      context.logger.success('Created $templateFileName at $packagePath');"
                }
              ]
            }
          ],
          "totalLines": 18,
          "totalMatchedLines": 18
        }
      }
    }
  }
}
```
Status: **completed**


</details>
</tool-use>

---


Using `context.logger.err()` to show an error, then re-prompting for the Firebase Project ID. Updating the validation to be more interactive:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---


Updating validation to show an error and re-prompt before throwing:


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>

</tool-use>

---





---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `src/hooks/pre_gen.dart`

Lint results

Lint errors for `src/hooks/pre_gen.dart`


| Message | Range | Severity |
|-------|-------|----------|
| The operand can't be 'null', so the condition is always 'false'.<br/>Try removing the condition, an enclosing condition, or the whole conditional statement. | 98:29-98:36 | DIAGNOSTIC_SEVERITY_WARNING |


</details>
</tool-use>

---


Fixing the linter warning by simplifying the null check:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---


Removing the unnecessary null check since `prompt()` returns a non-nullable String:


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>

</tool-use>

---





---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/hooks/pre_gen.dart"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/hooks/pre_gen.dart"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


Updated the validation to be more interactive. Here's what changed:

**Before:** Threw an exception immediately if `firebase_project_id` was empty.

**Now:**
1. Shows an error message using `context.logger.err()` with a warning icon
2. Displays an info message explaining what's needed
3. Re-prompts the user to enter the Firebase Project ID
4. Only throws an exception if the user still enters an empty value after the second prompt

**Benefits:**
- Gives the user a chance to correct their mistake
- Clearer error messaging
- Better UX — doesn't fail immediately
- Still enforces validation — throws if still empty after the second prompt

The flow is now:
1. First prompt (if not provided via config/args)
2. If empty → show error + info message
3. Second prompt (retry opportunity)
4. If still empty → throw exception with clear message

This provides a better user experience while maintaining validation.

---

_**User**_

wrap this and create helper class for it

---

_**Agent (model default, mode Agent)**_


Checking the existing helper structure, then extracting the Firebase project ID validation into a helper method:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---


Adding a helper method for Firebase project ID validation and updating `pre_gen.dart` to use it:


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper.dart</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>

</tool-use>

---





---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/hooks/pre_gen.dart",
    "src/hooks/helper.dart"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/hooks/pre_gen.dart"
    },
    {
      "relativeWorkspacePath": "src/hooks/helper.dart"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---


Verifying the final implementation:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/pre_gen.dart</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper.dart</summary>

</details>
</tool-use>

---


Refactored the Firebase project ID validation into a helper class.

## Changes Made:

1. **Added `validateFirebaseProjectId` method to `HookHelper` class** (`helper.dart`):
   - Static method that validates Firebase Project ID
   - Includes documentation comments
   - Handles error messages, re-prompting, and final validation
   - Follows the same pattern as other helper methods

2. **Updated `pre_gen.dart`**:
   - Added import for `helper.dart`
   - Replaced the inline validation code with a single call to `HookHelper.validateFirebaseProjectId(context)`
   - Reduced from ~30 lines to 1 line

## Benefits:

- **Reusability**: The validation logic can be used in other hooks if needed
- **Maintainability**: Centralized validation logic is easier to update
- **Consistency**: Follows the same pattern as other helper methods (`runCommand`, `overwriteFile`, `createPackageDirectory`)
- **Cleaner code**: `pre_gen.dart` is more readable and focused

The functionality remains the same: it shows interactive error messages, prompts the user again if the ID is empty, and throws an exception if validation fails after retry.

---

_**User**_

@src/hooks/helper/validation_helper.dart simplify this helper

---

_**Agent (model default, mode Agent)**_


Reviewing `validation_helper.dart` to simplify it:


---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper/validation_helper.dart</summary>

</details>
</tool-use>

---


Simplifying the validation helper by removing redundancy and streamlining the logic:


---

<tool-use data-tool-type="write" data-tool-name="edit_file_v2">

<details><summary>Tool use: **edit_file_v2** • Edit file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper/validation_helper.dart</summary>

</details>

</tool-use>

---





---

<tool-use data-tool-type="unknown" data-tool-name="read_lints">
<details>
<summary>Tool use: **read_lints**</summary>


Parameters:

```json
{
  "paths": [
    "src/hooks/helper/validation_helper.dart"
  ]
}
```
Result:

```json
{
  "linterErrorsByFile": [
    {
      "relativeWorkspacePath": "src/hooks/helper/validation_helper.dart"
    }
  ]
}
```
Status: **completed**


</details>
</tool-use>

---





---

<tool-use data-tool-type="read" data-tool-name="read_file_v2">
<details><summary>Tool use: **read_file_v2** • Read file: /Users/cirimin/Logique/Project Starter/project-starter/src/hooks/helper/validation_helper.dart</summary>

</details>
</tool-use>

---


Simplified the validation helper. Changes:

## Simplifications:

1. Added missing `use_firebase` check — early return if Firebase is disabled
2. Removed unnecessary helper function — removed `_getFirebaseProjectId()` and inlined the prompt
3. Removed redundant first prompt — now shows error first, then prompts once
4. Streamlined flow:
   - Check if Firebase is enabled
   - Check if project ID is empty
   - Show error message
   - Prompt once
   - Validate and throw if still empty

**Before:** 45 lines with redundant prompts and an unnecessary helper function  
**After:** 37 lines with a single, clear validation flow

The functionality remains the same: it validates the Firebase Project ID when Firebase is enabled, shows an interactive error message, prompts the user once, and throws an exception if validation fails.

---

