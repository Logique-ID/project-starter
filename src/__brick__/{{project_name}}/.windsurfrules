{
  "version": 1,
  "rules": [
    {
      "name": "Project Overview",
      "globs": ["*"],
      "description": "Flutter project with feature-based architecture",
      "content": "# Project Overview\n\n## Tech Stack\n- **Framework**: Flutter 3.38.0+\n- **Language**: Dart 3.8.1+\n- **State Management**: Riverpod 3.0.3 (with code generation)\n- **Routing**: GoRouter 17.0.0\n- **Local Database**: Sembast 3.8.5+2\n- **HTTP Client**: Dio 5.9.0\n- **Responsive Design**: Flutter ScreenUtil 5.9.3\n\n## Directory Structure\n- `lib/src/common_widget/` - Reusable widgets\n- `lib/src/feature/` - Feature modules organized by domain\n- `lib/src/localization/` - Localization files (en, id)\n- `lib/src/routing/` - GoRouter configuration\n- `lib/src/theme/` - App theming\n\n## Feature Module Structure\n```\nfeature_name/\n  ├── data/\n  │   ├── feature_repository.dart\n  │   └── feature_repository.g.dart\n  ├── domain/\n  │   └── *.dart\n  └── presentation/\n      ├── feature_screen.dart\n      ├── controller/\n      │   ├── feature_event.dart\n      │   └── feature_state.dart\n      └── widget/\n```\n"
    },
    {
      "name": "Dart Code Conventions",
      "globs": ["*.dart"],
      "description": "Dart code style and conventions",
      "content": "# Dart Code Conventions\n\n## Code Style\n- Follow Dart style guide and Flutter conventions\n- Use `prefer_const_constructors` and `prefer_const_literals_to_create_immutables`\n- Prefer single quotes for strings\n- Always use semicolons\n\n## Variable Declarations\n**Avoid `var` and `dynamic`** - Always use explicit types or `final`:\n- Use `final` for variables that won't be reassigned\n- Use explicit type when reassignment is needed or type is important\n\n```dart\n// ✅ Correct\nfinal String name = 'John';\nfinal int count = 42;\nString message = 'Hello';\nmessage = 'World';\n\n// ❌ Wrong\nvar name = 'John';\ndynamic data = fetchData();\n```\n\n## Imports Order\n1. Dart SDK imports\n2. Flutter imports\n3. Package imports (third-party)\n4. Project imports (package:)\n\n## File Naming (snake_case)\n- Screen files: `*_screen.dart`\n- Sub-screen files: `*_subscreen.dart`\n- Widget files: `*_widget.dart`\n- Repository files: `*_repository.dart`\n- Controller files: `*_controller.dart`, `*_event.dart`, `*_state.dart`\n- Model files: `*_response.dart`, `*_model.dart`\n\n## Model Classes\n**Prefer `num` over `int` or `double`** for JSON numeric fields:\n```dart\nclass ProductResponse {\n  final num price;\n  final num quantity;\n  final num? discount;\n  \n  factory ProductResponse.fromJson(Map<String, dynamic> json) {\n    return ProductResponse(\n      price: json['price'] as num,\n      quantity: json['quantity'] as num,\n      discount: json['discount'] as num?,\n    );\n  }\n}\n```\n\n## Code Generation\n- Files using `@riverpod`/`@Riverpod` need `.g.dart` files\n- Include `part 'filename.g.dart';` at top\n- Run `flutter pub run build_runner build --delete-conflicting-outputs`\n- Never manually edit `.g.dart` files\n\n## Widget Conventions\n- Use `const` constructors when possible\n- Prefer `ConsumerWidget` or `ConsumerStatefulWidget` for Riverpod\n- Use mixins for shared behavior (e.g., `HomeEvent`, `HomeState`)\n"
    },
    {
      "name": "Riverpod Patterns",
      "globs": ["**/controller/*.dart", "**/data/*.dart", "*_repository.dart", "*_provider.dart"],
      "description": "Riverpod state management patterns",
      "content": "# Riverpod Patterns\n\n## Provider Access Rules\n**CRITICAL**: Never use `ref.watch()` or `ref.read()` directly in UI layer files.\n\n### ✅ Allowed in UI Layer\n- `ref.listen()` - For side effects (snackbars, navigation, async results)\n\n### ❌ NOT Allowed in UI Layer\n- `ref.watch()` - Must be in state/event mixins\n- `ref.read()` - Must be in state/event mixins\n\n### ✅ Correct Pattern\n**State Mixins** (`*_state.dart`):\n```dart\nmixin class HomeState {\n  AsyncValue<NewsListResponse?> getNewsList(WidgetRef ref) =>\n      ref.watch(getNewsListProvider);\n}\n```\n\n**Event Mixins** (`*_event.dart`):\n```dart\nmixin class HomeEvent {\n  void goToNewsDetail(WidgetRef ref, String newsId) {\n    ref.read(goRouterProvider).goNamed(\n      AppRoute.newsDetail.name,\n      pathParameters: {'currentIndex': '0'},\n      queryParameters: {'newsId': newsId},\n    );\n  }\n}\n```\n\n**UI Layer**:\n```dart\nclass HomeSubscreen extends ConsumerWidget with HomeEvent, HomeState {\n  @override\n  Widget build(BuildContext context, WidgetRef ref) {\n    final newsList = getNewsList(ref); // ✅ Call mixin method\n    ref.listen(controllerProvider, (prev, next) { /* side effects */ });\n  }\n}\n```\n\n## Provider Types\n- **Repository Providers**: `@riverpod` or `@Riverpod(keepAlive: true)`\n- **State Providers**: `StateProvider` for simple state\n- **StateProviders for forms**: `StateProvider.autoDispose` in controller files\n\n## Async State Management\n- Use `AsyncValue` for async operations\n- Use `AsyncValueWidget` for displaying async data\n\n## Controller Async Pattern\n```dart\n@riverpod\nclass ForgotPasswordController extends _$ForgotPasswordController {\n  @override\n  FutureOr<void> build() {}\n\n  Future<void> forgotPassword({required String email}) async {\n    state = const AsyncValue.loading();\n    state = await AsyncValue.guard(\n      () => ref.watch(forgotPasswordProvider(email: email).future),\n    );\n  }\n}\n```\n\n## File Upload Pattern\n- Use `FormData` with `MultipartFile.fromFile()`\n- Store file path in `StateProvider.autoDispose<String?>`\n- Conditionally upload in controller\n\n## Refreshing Multiple Providers\n```dart\nFuture<void> refreshHome(WidgetRef ref) async {\n  await Future.wait([\n    ref.refresh(getBannerListProvider.future),\n    ref.refresh(getNewsListProvider.future),\n  ]);\n}\n```\n"
    },
    {
      "name": "Flutter UI Patterns",
      "globs": ["**/presentation/**/*.dart", "**/common_widget/**/*.dart"],
      "description": "Flutter UI and responsive design patterns",
      "content": "# Flutter UI Patterns\n\n## Responsive Design\nAlways use **Flutter ScreenUtil**:\n- Width: `.w` extension (e.g., `16.w`)\n- Height: `.h` extension (e.g., `24.h`)\n- Font size: `.sp` extension (e.g., `14.sp`)\n- Radius: `.r` extension (e.g., `8.r`)\n\nDesign size: `Size(360, 800)`\n\n## Spacing\nUse predefined gap constants:\n- Horizontal: `gapW4`, `gapW8`, `gapW12`, `gapW16`\n- Vertical: `gapH4`, `gapH8`, `gapH12`, `gapH16`\n\n## Theming\nUse theme constants:\n- Colors: `AppColorTheme.primary500`, etc.\n- Text: `AppTextTheme.boldBase`, etc.\n- Sizes: `Sizes.p16`, etc.\n\n## Localization\nAlways use localization for user-facing strings:\n- Use `LocalizationMixin` - call `getLocalizations(ref)` for `AppLocalizations`\n- Use generated keys: `loc.appTitle`, `loc.view_all`\n- Never hardcode user-facing strings\n\n```dart\nclass HomeSubscreen extends ConsumerWidget with HomeEvent, HomeState, LocalizationMixin {\n  @override\n  Widget build(BuildContext context, WidgetRef ref) {\n    final loc = getLocalizations(ref);\n    return Text(loc.appTitle);\n  }\n}\n```\n\n## Loading States\nUse `AsyncValueWidget` for async data:\n```dart\nAsyncValueWidget(\n  value: getNewsList(ref),\n  customLoading: const ShimmerLoadingItem(), // ✅ Better than CircularProgressIndicator\n  data: (newsList) => ListView(...),\n)\n```\n\n## Pagination Patterns\n### Pattern 1: ListView (no categories)\n```dart\nCategorizedTabBodyView<NotificationResponse, NotificationData>(\n  categoryId: 0,\n  viewType: ViewType.listView,\n  firstPageValue: getNotificationList(ref, page: 1),\n  getPageValue: (page) => getNotificationList(ref, page: page),\n  extractTotal: (data) => data?.data?.total,\n  extractItems: (data) => data?.data?.notificationData,\n  onRefresh: () async => onRefresh(ref),\n  buildItem: (context, item) => ItemNotificationWidget(...),\n);\n```\n\n### Pattern 2: TableView (with filters)\n- Use `LayoutBuilder` for dynamic table height\n- Wrap table in fixed-height `SizedBox`\n- Filter form collapsible (accordion pattern)\n\n### Pattern 3: GridView (with tabs)\n```dart\nCategorizedTabView<...>(\n  categoriesValue: getCompanyCategoryList(ref),\n  buildTabBarViewChild: (context, ref, category) {\n    return CategorizedTabBodyView(\n      categoryId: category.id ?? 0,\n      viewType: ViewType.gridView,\n      // ...\n    );\n  },\n);\n```\n\n### Pattern 4: GridView (simple, no tabs)\n- Same as Pattern 1 but with `viewType: ViewType.gridView`\n\n## Item Widgets\n- Always stateless\n- Accept domain model + callbacks\n- Filename: `item_*_widget.dart`\n- Lives in `feature/*/presentation/widget/`\n\n## Images\n- Use `CachedNetworkImage` for network images\n- Use `Image.asset()` with constants for assets\n- Use `SvgPicture.asset()` for SVG\n- Provide placeholder and error widgets\n\n## Forms\n- Use `flutter_form_builder` for form handling\n- Use shared form widgets: `CustomDropdownFormField`, `CustomTextFormField`, `CustomDatePickerField`\n- Validation logic in event mixins (`*_event.dart`)\n- Use `StateProvider.autoDispose` for form selections\n\n## Pull-to-Refresh\nUse `any_refreshable_widget` package:\n```dart\nAnyRefreshableWidget.single(\n  onRefresh: () async => await refreshHome(ref),\n  refreshColor: AppColorTheme.primary500,\n  builder: (context, isLoading, error) {\n    return SingleChildScrollView(\n      child: Column(children: [...]),\n    );\n  },\n);\n```\n\n## AppBar - Platform-Specific Back Button\n```dart\nAppBar(\n  leading: IconButton(\n    onPressed: () => context.pop(),\n    icon: Icon(\n      Platform.isIOS ? Icons.arrow_back_ios : Icons.arrow_back,\n      color: AppColorTheme.white,\n    ),\n  ),\n)\n```\n"
    },
    {
      "name": "Routing Patterns",
      "globs": ["**/routing/**/*.dart"],
      "description": "GoRouter navigation patterns",
      "content": "# Routing Patterns\n\n## GoRouter Configuration\nRoutes defined in `AppRoute` enum:\n```dart\nenum AppRoute {\n  mainNav,\n  login,\n  register,\n  newsDetail,\n}\n```\n\n## Navigation\n### Named Navigation\n```dart\nref.read(goRouterProvider).goNamed(\n  AppRoute.newsDetail.name,\n  pathParameters: {'currentIndex': '0'},\n  queryParameters: {'newsId': newsId},\n);\n```\n\n### Passing Complex Objects\nUse GoRouter's `extra` parameter:\n```dart\n// Event mixin\nvoid goToReportDetail(WidgetRef ref, ReportItem reportItem) {\n  ref.read(goRouterProvider).goNamed(\n    AppRoute.myReportDetail.name,\n    pathParameters: {'currentIndex': '0'},\n    extra: reportItem,\n  );\n}\n\n// Router\nGoRoute(\n  path: MyReportDetailScreen.path,\n  name: AppRoute.myReportDetail.name,\n  pageBuilder: (context, state) {\n    final reportItem = state.extra as ReportItem?;\n    return _transitionPage(\n      state: state,\n      child: MyReportDetailScreen(reportItem: reportItem),\n    );\n  },\n)\n```\n\n### pushNamed vs goNamed\n- **`pushNamed`**: Detail screens, forms (maintains navigation stack)\n- **`goNamed`**: Main screens, tabs (replaces current route)\n\n## Navigation from Mixins\nAlways use event mixins for navigation:\n```dart\nmixin class HomeEvent {\n  void goToNewsDetail(WidgetRef ref, String newsId) {\n    ref.read(goRouterProvider).goNamed(\n      AppRoute.newsDetail.name,\n      pathParameters: {'currentIndex': '0'},\n      queryParameters: {'newsId': newsId},\n    );\n  }\n}\n```\n"
    },
    {
      "name": "Analytics & Debugging",
      "globs": ["*"],
      "description": "Firebase Analytics and debugging guidelines",
      "content": "# Analytics & Debugging\n\n## Analytics Implementation\n- Use Facade pattern with `AnalyticsClient` abstraction\n- Implementations: `FirebaseAnalyticsClient` (prod), `LoggerAnalyticsClient` (debug)\n- Use `Future.wait(clients.map(work))` for parallel execution\n\n## Debug Logging\n- Use `LoggerAnalyticsClient` for debug-mode logging\n- Integrate `LoggerNavigatorObserver` into GoRouter observers\n\n## Common Issues\n- If analytics reports missing, check:\n  - Analytics client initialization\n  - `LoggerNavigatorObserver` added to GoRouter observers\n  - Correct event trigger (e.g., `trackLogin()` on login)\n  - Platform configs in `firebase.json`\n  - `IS_ANALYTICS_ENABLED` set to `<true/>` in `GoogleService-Info.plist`\n\n## DOs and DON'Ts\n- ✅ DO ensure semantic correctness (e.g., `trackLogin()` on login)\n- ✅ DO ensure `IS_ANALYTICS_ENABLED` is `<true/>` in plist files\n- ❌ DON'T forget to add `LoggerNavigatorObserver()` to GoRouter\n"
    }
  ]
}
